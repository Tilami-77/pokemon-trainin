<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¶å¯å¤¢æˆ°è¡“ç‰¹è¨“ - Mega å®Œç¾ä¿®å¾©ç‰ˆ</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --sidebar-bg: #252525;
            --text-main: #e0e0e0;
            --text-sub: #aaaaaa;
            --border-color: #333333;
            
            --btn-exit: #546e7a;
            --btn-random: #673ab7;
            --btn-chart: #0277bd;
            --btn-sound: #ad1457;
            --btn-mega-x: #3f51b5;
            --btn-mega-y: #f57c00;
            --btn-mega-generic: #e91e63;
            --mega-glow: 0 0 15px #ff4081;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            user-select: none;
        }

        /* Header */
        .header-bar {
            width: 100%; max-width: 850px; display: grid; grid-template-columns: 1fr auto 1fr;
            align-items: center; margin: 10px 0; position: relative;
        }
        h1 { margin: 0; color: #ffffff; font-size: 1.4em; text-shadow: 0 2px 4px rgba(0,0,0,0.5); text-align: center; white-space: nowrap; }
        .header-left { justify-self: start; }
        .header-right { justify-self: end; }
        .header-btn {
            color: white; border: none; padding: 6px 12px; border-radius: 20px; cursor: pointer; font-weight: bold; font-size: 0.85em;
            box-shadow: 0 2px 5px rgba(0,0,0,0.4); display: flex; align-items: center; gap: 4px; transition: transform 0.1s;
        }
        .header-btn:active { transform: scale(0.95); }
        .btn-chart { background-color: var(--btn-chart); }
        .btn-sound { background-color: var(--btn-sound); width: 90px; justify-content: center; }
        .btn-sound.muted { background-color: #616161; }

        /* é€šç”¨å®¹å™¨ */
        .container {
            background: var(--card-bg); padding: 15px; border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); border: 1px solid var(--border-color);
            width: 100%; max-width: 850px; text-align: center; display: none; box-sizing: border-box;
        }
        .active { display: block !important; }

        .status-bar { display: flex; justify-content: flex-end; background: #2c2c2c; padding: 8px 15px; border-radius: 8px; margin-bottom: 10px; font-weight: bold; color: #ccc; }

        /* æˆ°è¡“æ–‡å­— */
        .text-super { color: #ff5252; font-weight: bold; }
        .text-weak { color: #448aff; font-weight: bold; }
        .text-immune { color: #bdbdbd; font-weight: bold; }
        .text-normal { color: #9e9e9e; font-weight: bold; }
        .text-perfect { color: #ffd740; font-weight: bold; font-size: 1.1em; text-shadow: 0 0 8px rgba(255, 215, 64, 0.4); }

        /* çµæœ Grid */
        .result-grid { display: grid; grid-template-columns: 1fr auto 1fr; width: 100%; align-items: center; gap: 10px; }
        .result-col { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; }
        .result-divider { font-size: 1.5em; color: #555; font-weight: 300; }
        .result-val { font-size: 1.1em; color: #fff; font-weight: bold; }
        .defense-row { display: flex; align-items: center; justify-content: center; gap: 10px; margin: 5px 0; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px; width: 100%; box-sizing: border-box; }

        /* åœ–æ¨™ */
        .type-icon-wrapper { display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; border-radius: 50%; vertical-align: middle; margin-right: 5px; box-shadow: 1px 1px 3px rgba(0,0,0,0.5); flex-shrink: 0; }
        .type-icon-svg { width: 14px; height: 14px; filter: brightness(0) invert(1); }
        .mini-type-dot { width: 14px; height: 14px; border-radius: 50%; display: inline-block; margin: 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.2); }

        /* Mega æŒ‰éˆ• */
        .control-panel { display: flex; justify-content: center; align-items: center; margin-top: 15px; gap: 10px; flex-wrap: wrap; min-height: 50px; }
        .mega-btn { background-color: #333; color: #fff; border: 1px solid #555; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: bold; display: none; align-items: center; gap: 6px; font-size: 0.9em; transition: all 0.2s ease; }
        .mega-btn img { width: 20px; height: 20px; }
        .mega-btn.visible { display: flex; }
        .mega-btn:hover { transform: translateY(-2px); filter: brightness(1.2); }
        .mega-btn.active { box-shadow: 0 0 10px currentColor; border-color: #fff; }
        .mega-x { background-color: var(--btn-mega-x); }
        .mega-y { background-color: var(--btn-mega-y); }
        .mega-gen { background-color: var(--btn-mega-generic); }

        /* Draft */
        .draft-layout { display: flex; height: 480px; gap: 15px; border: 1px solid #444; border-radius: 8px; overflow: hidden; margin-bottom: 15px; background: #181818; }
        .draft-sidebar { width: 140px; background: var(--sidebar-bg); overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 5px; border-right: 1px solid #444; }
        .draft-main { flex: 1; overflow-y: auto; padding: 15px; background: #1e1e1e; }
        .draft-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 12px; }
        
        .draft-card { border: 1px solid #444; border-radius: 8px; padding: 10px 5px; cursor: pointer; background: #2d2d2d; display: flex; flex-direction: column; align-items: center; position: relative; transition: transform 0.1s, box-shadow 0.1s; min-height: 115px; justify-content: flex-start; gap: 6px; }
        .draft-card:hover { background: #383838; transform: translateY(-2px); box-shadow: 0 2px 5px rgba(0,0,0,0.5); }
        .draft-card.picked { background-color: #1b5e20; border-color: #4caf50; box-shadow: 0 0 0 2px #4caf50; opacity: 1; }
        .draft-card.picked::after { content: 'âœ”'; position: absolute; top: 4px; right: 4px; background: #4caf50; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 12px; display: flex; align-items: center; justify-content: center; z-index: 2; }
        .draft-card img { width: 65px; height: 65px; object-fit: contain; flex-shrink: 0; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.5)); }
        .draft-name { font-size: 0.85em; font-weight: bold; text-align: center; line-height: 1.2; width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #eee; }
        .draft-types { display: flex; gap: 4px; justify-content: center; flex-wrap: wrap; width: 100%; }
        .mega-indicator { position: absolute; top: 4px; left: 4px; width: 18px; height: 18px; background: url('https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/key-stone.png') no-repeat center/contain; filter: drop-shadow(0 0 2px #fff); z-index: 1; }

        /* Gallery */
        .gallery-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px;
            max-height: 60vh; overflow-y: auto; padding: 10px; background: #181818; border-radius: 8px;
        }
        .gallery-card {
            background: #2d2d2d; border: 1px solid #555; border-radius: 8px; padding: 10px;
            display: flex; flex-direction: column; align-items: center; gap: 5px;
        }
        .gallery-card img { width: 80px; height: 80px; object-fit: contain; }
        .gallery-id { font-size: 0.75em; color: #888; font-family: monospace; }
        .gallery-name { font-size: 0.9em; font-weight: bold; text-align: center; }

        @media (max-width: 600px) {
            .draft-layout { flex-direction: column; height: 550px; }
            .draft-sidebar { width: 100%; height: 80px; flex-direction: row; overflow-x: auto; border-right: none; border-bottom: 1px solid #444; white-space: nowrap; }
            .filter-btn { min-width: 90px; }
            .draft-grid { grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); }
        }

        .filter-btn { padding: 8px; border: 1px solid #444; border-radius: 5px; font-size: 0.9em; cursor: pointer; background: #2d2d2d; color: #ccc; display: flex; align-items: center; justify-content: center; gap: 6px; transition: background 0.2s; }
        .filter-btn.active { background: #ddd; color: #222; border-color: #fff; }

        /* æˆ°é¬¥ç•«é¢ */
        .enemy-display { margin: 15px 0; min-height: 150px; display: flex; flex-direction: column; align-items: center; justify-content: center;}
        .enemy-img { width: 140px; height: 140px; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.6)); opacity: 0; transition: opacity 0.5s ease-in; }
        .type-badge-text { padding: 4px 10px; border-radius: 20px; color: white; font-size: 0.9em; font-weight: bold; margin: 0 2px; display: inline-flex; align-items: center; gap: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.3); }

        .battle-team-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
        .team-card { background: #2d2d2d; border: 2px solid #444; border-radius: 8px; padding: 8px; cursor: pointer; transition: transform 0.1s; display: flex; flex-direction: column; align-items: center; gap: 5px; color: #eee; }
        .team-card:active { transform: scale(0.95); }
        .team-card.selected { border-color: #ddd; background: #424242; box-shadow: 0 0 8px rgba(255,255,255,0.2); }

        .grid-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 10px; }
        @media(min-width: 500px) { .grid-container { grid-template-columns: repeat(6, 1fr); } }

        .game-btn { padding: 8px; border: 2px solid transparent; border-radius: 6px; color: white; cursor: pointer; font-weight: bold; font-size: 0.95em; display: flex; align-items: center; justify-content: center; gap: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.3); transition: transform 0.1s; }
        .game-btn:active { transform: scale(0.95); }
        .game-btn.selected { border-color: #fff; transform: scale(1.05); box-shadow: 0 0 8px rgba(255,255,255,0.3); }

        .action-btn { width: 100%; padding: 12px; font-size: 1.1em; color: white; border: none; border-radius: 8px; margin-top: 10px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.3); transition: transform 0.1s, box-shadow 0.1s; }
        .action-btn:active { transform: scale(0.98); box-shadow: 0 2px 3px rgba(0,0,0,0.3); }
        .btn-menu { background-color: #5c6bc0; margin-bottom: 10px; }
        .btn-confirm { background-color: #2e7d32; flex: 2; margin-top: 0; } 
        .btn-next { background-color: #f57c00; display: none; }
        .btn-exit { background-color: var(--btn-exit); margin-top: 15px; }
        .btn-exit:hover { background-color: #78909c; }
        .btn-random { background-color: var(--btn-random); margin-bottom: 10px; }
        .btn-random:hover { background-color: #7e57c2; }
        .btn-check { background-color: #455a64; margin-top: 20px; }

        #round-log { background: #2d2d2d; padding: 10px; border-radius: 8px; min-height: 3em; font-size: 1em; border: 1px solid #444; display: flex; align-items: center; justify-content: center; flex-direction: column; line-height: 1.6; color: #eee; }

        /* å±¬æ€§é¡è‰² */
        .bg-normal { background: #a8a878; color:#fff; } .bg-fire { background: #f08030; } .bg-water { background: #6890f0; }
        .bg-grass { background: #78c850; } .bg-electric { background: #f8d030; color:#333; } .bg-ice { background: #98d8d8; color:#333; }
        .bg-fighting { background: #c03028; } .bg-poison { background: #a040a0; } .bg-ground { background: #e0c068; color:#333; }
        .bg-flying { background: #a890f0; } .bg-psychic { background: #f85888; } .bg-bug { background: #a8b820; }
        .bg-rock { background: #b8a038; } .bg-ghost { background: #705898; } .bg-dragon { background: #7038f8; }
        .bg-steel { background: #b8b8d0; color:#333; } .bg-dark { background: #705848; } .bg-fairy { background: #ee99ac; color:#333; }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 999; display: none; justify-content: center; align-items: center; }
        .modal-content { background: #252525; width: 95%; max-width: 800px; height: 85%; border-radius: 10px; padding: 10px; display: flex; flex-direction: column; box-shadow: 0 5px 25px rgba(0,0,0,0.8); color: #fff; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 10px; border-bottom: 1px solid #444; margin-bottom: 10px; }
        .modal-body { flex: 1; overflow: auto; }
        .chart-table { border-collapse: collapse; width: 100%; font-size: 0.8em; }
        .chart-table th, .chart-table td { border: 1px solid #444; padding: 4px; text-align: center; min-width: 25px; }
        .chart-header { position: sticky; top: 0; background: #333; z-index: 2; }
        .chart-side-header { position: sticky; left: 0; background: #333; z-index: 1; }
        .cell-2x { background-color: #5c0000; color: #ff8a80; font-weight: bold; }
        .cell-05x { background-color: #0d47a1; color: #82b1ff; }
        .cell-0x { background-color: #424242; color: #bdbdbd; }
    </style>
</head>
<body>

    <div class="header-bar">
        <div class="header-left">
            <button class="header-btn btn-sound" id="btn-sound" onclick="game.toggleSound()">ğŸ”Š é–‹å•Ÿ</button>
        </div>
        <h1>å¯¶å¯å¤¢æˆ°è¡“ç‰¹è¨“</h1>
        <div class="header-right">
            <button class="header-btn btn-chart" onclick="game.toggleChart()">ğŸ“– å±¬æ€§è¡¨</button>
        </div>
    </div>

    <!-- 1. ä¸»é¸å–® -->
    <div id="screen-menu" class="container active">
        <p>é¸æ“‡è¨“ç·´æ¨¡å¼ï¼š</p>
        <button class="action-btn btn-menu" onclick="game.initMode('attack')">âš”ï¸ æ”»æ“Šç‰¹è¨“<br><span style="font-size:0.8em; font-weight:normal; color:#bbb;">é¸æ“‡å‰‹åˆ¶å±¬æ€§</span></button>
        <button class="action-btn btn-menu" style="background-color: #00695c;" onclick="game.initMode('defense')">ğŸ›¡ï¸ é˜²å®ˆç‰¹è¨“<br><span style="font-size:0.8em; font-weight:normal; color:#bbb;">é¸æ“‡æŠµæŠ—å±¬æ€§</span></button>
        <button class="action-btn btn-menu" style="background-color: #ef6c00;" onclick="game.initMode('team')">ğŸ‘¥ 6é¸1 å¯¦æˆ°æ¨¡æ“¬<br><span style="font-size:0.8em; font-weight:normal; color:#bbb;">éšŠä¼å¯¦æˆ°ï¼Œè¬›æ±‚æ”»é˜²ä¸€é«”</span></button>
        
        <!-- æª¢é©—æŒ‰éˆ• -->
        <button class="action-btn btn-check" onclick="game.openGallery()">ğŸ—‚ï¸ Mega åœ–é‘‘ / æª¢è¦–æ¨¡å¼<br><span style="font-size:0.8em; font-weight:normal; color:#bbb;">æª¢è¦–æ‰€æœ‰Megaå‹æ…‹åœ–ç‰‡èˆ‡ID</span></button>
    </div>

    <!-- 2. éšŠä¼é¸æ“‡ -->
    <div id="screen-draft" class="container" style="max-width: 850px;">
        <h2>çµ„å»ºä½ çš„éšŠä¼ (<span id="draft-count">0</span>/6)</h2>
        <button class="action-btn btn-random" onclick="game.randomDraft()">ğŸ² éš¨æ©Ÿçµ„éšŠ (å±¬æ€§å¹³è¡¡)</button>
        <div class="draft-layout">
            <div class="draft-sidebar" id="draft-filter-list"></div>
            <div class="draft-main"><div id="draft-grid" class="draft-grid"></div></div>
        </div>
        <button id="btn-start-team" class="action-btn" disabled onclick="game.finishDraft()" style="background:#555; cursor:not-allowed;">é–‹å§‹æˆ°é¬¥</button>
        <button class="action-btn btn-exit" onclick="game.quitToMenu()">é€€å‡ºå›åˆ°é¸å–®</button>
    </div>

    <!-- 3. éŠæˆ²ä¸»ç•«é¢ -->
    <div id="screen-game" class="container" style="max-width: 600px;">
        <div class="status-bar"><div>å›åˆ: <span id="round-current">1</span>/10</div></div>
        <div class="enemy-display">
            <img id="enemy-img" class="enemy-img" src="" alt="Enemy">
            <div id="enemy-name" style="font-size:1.5em; font-weight:bold; margin:5px 0; opacity: 0; transition: opacity 0.5s; color: #fff;">???</div>
            <div id="enemy-reveal" style="min-height:34px;"><span style="color:#777">??? å±¬æ€§ ???</span></div>
        </div>
        
        <div id="round-log">ç­‰å¾…å°æ‰‹å‡ºç¾...</div>

        <div id="ui-types" class="grid-container" style="display:none;"></div>
        <div id="ui-team" class="battle-team-grid" style="display:none;"></div>

        <div class="control-panel">
            <div id="mega-controls" style="display: flex; gap: 8px;"></div>
            <button id="btn-submit" class="action-btn btn-confirm" onclick="game.submit()">ç¢ºèªé¸æ“‡</button>
        </div>
        
        <button id="btn-next" class="action-btn btn-next" onclick="game.nextRound()">ä¸‹ä¸€å›åˆ âœ</button>
        <button class="action-btn btn-exit" onclick="game.quitToMenu()">é€€å‡ºå›åˆ°é¸å–®</button>
    </div>

    <!-- 4. çµç®—ç•«é¢ -->
    <div id="screen-result" class="container">
        <h2>è¨“ç·´çµæŸ</h2>
        <p style="font-size:1.2em; margin:20px 0;">ç‰¹è¨“å®Œæˆï¼</p>
        <button class="action-btn" onclick="location.reload()">å›åˆ°ä¸»é¸å–®</button>
    </div>

    <!-- 5. Mega åœ–é‘‘ (Debug) ç•«é¢ -->
    <div id="screen-gallery" class="container" style="max-width: 850px;">
        <h2>Mega å½¢æ…‹åœ–é‘‘æª¢è¦–</h2>
        <p style="font-size:0.9em; color:#888;">è³‡æ–™åº«å®Œæ•´æ ¡æ­£ç‰ˆ</p>
        <div id="gallery-container" class="gallery-grid"></div>
        <button class="action-btn btn-exit" onclick="game.quitToMenu()">é€€å‡ºå›åˆ°é¸å–®</button>
    </div>

    <!-- 6. å±¬æ€§è¡¨å°æŠ„ (Modal) -->
    <div id="modal-chart" class="modal-overlay" onclick="game.toggleChart()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header"><h3 style="margin:0">å±¬æ€§ç›¸å‰‹è¡¨ (æ”» \ å®ˆ)</h3><button onclick="game.toggleChart()" style="border:none;background:none;font-size:1.5em;cursor:pointer;color:#fff;">âœ•</button></div>
            <div class="modal-body"><div id="chart-container"></div></div>
        </div>
    </div>

    <script>
        // === 1. æ ¸å¿ƒè³‡æ–™åº« ===
        const RAW_DATA = [
            "3|å¦™è›™èŠ±|grass|poison","6|å™´ç«é¾|fire|flying","9|æ°´ç®­é¾œ|water","12|å·´å¤§è¶|bug|flying","15|å¤§é‡èœ‚|bug|poison","18|å¤§æ¯”é³¥|normal|flying","24|é˜¿æŸæ€ª|poison","26|é›·ä¸˜|electric","28|ç©¿å±±ç‹|ground","31|å°¼å¤šå|poison|ground","34|å°¼å¤šç‹|poison|ground","36|çš®å¯è¥¿|fairy","38|ä¹å°¾|fire","40|èƒ–å¯ä¸|normal|fairy","45|éœ¸ç‹èŠ±|grass|poison","47|æ´¾æ‹‰æ–¯ç‰¹|bug|grass","49|æ‘©é­¯è›¾|bug|poison","51|ä¸‰åœ°é¼ |ground","53|è²“è€å¤§|normal","55|å“¥é”é´¨|water","57|ç«çˆ†çŒ´|fighting","59|é¢¨é€Ÿç‹—|fire","62|å¿«æ³³è›™|water|fighting","65|èƒ¡åœ°|psychic","68|æ€ªåŠ›|fighting","71|å¤§é£ŸèŠ±|grass|poison","73|æ¯’åˆºæ°´æ¯|water|poison","76|éš†éš†å²©|rock|ground","78|çƒˆç„°é¦¬|fire","80|å‘†æ®¼ç¸|water|psychic","82|ä¸‰åˆä¸€ç£æ€ª|electric|steel","83|å¤§è”¥é´¨|normal|flying","85|å˜Ÿå˜Ÿåˆ©|normal|flying","87|ç™½æµ·ç…|water|ice","89|è‡­è‡­æ³¥|poison","91|åˆºç”²è²|water|ice","94|è€¿é¬¼|ghost|poison","95|å¤§å²©è›‡|rock|ground","97|å¼•å¤¢è²˜äºº|psychic","99|å·¨é‰—èŸ¹|water","101|é ‘çš®é›·å½ˆ|electric","103|æ¤°è›‹æ¨¹|grass|psychic","105|å˜å•¦å˜å•¦|ground","106|é£›è…¿éƒ|fighting","107|å¿«æ‹³éƒ|fighting","110|é›™å½ˆç“¦æ–¯|poison","112|é‘½è§’çŠ€ç¸|ground|rock","115|è¢‹ç¸|normal","119|é‡‘é­šç‹|water","121|å¯¶çŸ³æµ·æ˜Ÿ|water|psychic","122|é­”ç‰†äººå¶|psychic|fairy","123|é£›å¤©è³è‚|bug|flying","124|è¿·å”‡å§|ice|psychic","127|å‡±ç¾…æ–¯|bug","128|è‚¯æ³°ç¾…|normal","130|æš´é¯‰é¾|water|flying","131|æ‹‰æ™®æ‹‰æ–¯|water|ice","132|ç™¾è®Šæ€ª|normal","134|æ°´ä¼Šå¸ƒ|water","135|é›·ä¼Šå¸ƒ|electric","136|ç«ä¼Šå¸ƒ|fire","142|åŒ–çŸ³ç¿¼é¾|rock|flying","143|å¡æ¯”ç¸|normal","144|æ€¥å‡é³¥|ice|flying","145|é–ƒé›»é³¥|electric|flying","146|ç«ç„°é³¥|fire|flying","149|å¿«é¾|dragon|flying","150|è¶…å¤¢|psychic","151|å¤¢å¹»|psychic",
            "154|å¤§ç«ºè‘µ|grass","157|ç«æš´ç¸|fire","160|å¤§åŠ›é±·|water","162|å¤§å°¾ç«‹|normal","164|è²“é ­å¤œé·¹|normal|flying","166|å®‰ç“¢èŸ²|bug|flying","168|é˜¿åˆ©å¤šæ–¯|bug|poison","169|å‰å­—è |poison|flying","171|é›»ç‡ˆæ€ª|water|electric","178|å¤©ç„¶é³¥|psychic|flying","181|é›»é¾|electric","182|ç¾éº—èŠ±|grass","184|ç‘ªåŠ›éœ²éº—|water|fairy","185|æ¨¹æ‰æ€ª|rock","186|ç‰›è›™å›|water","189|æ¯½å­æ£‰|grass|flying","192|å‘æ—¥èŠ±æ€ª|grass","195|æ²¼ç‹|water|ground","196|å¤ªé™½ä¼Šå¸ƒ|psychic","197|æœˆäº®ä¼Šå¸ƒ|dark","199|å‘†å‘†ç‹|water|psychic","202|æœç„¶ç¿|psychic","203|éº’éºŸå¥‡|normal|psychic","205|ä½›çƒˆæ‰˜æ–¯|bug|steel","206|åœŸé¾å¼Ÿå¼Ÿ|normal","208|å¤§é‹¼è›‡|steel|ground","210|å¸ƒé­¯çš‡|fairy","212|å·¨é‰—è³è‚|bug|steel","213|å£ºå£º|bug|rock","214|èµ«æ‹‰å…‹ç¾…æ–¯|bug|fighting","217|åœˆåœˆç†Š|normal","219|ç†”å²©è¸ç‰›|fire|rock","222|å¤ªé™½çŠç‘š|water|rock","224|ç« é­šæ¡¶|water","225|ä¿¡ä½¿é³¥|ice|flying","226|å·¨ç¿…é£›é­š|water|flying","227|ç›”ç”²é³¥|steel|flying","229|é»‘é­¯åŠ |dark|fire","230|åˆºé¾ç‹|water|dragon","232|é “ç”²|ground","235|åœ–åœ–çŠ¬|normal","237|æˆ°èˆéƒ|fighting","241|å¤§å¥¶ç½|normal","242|å¹¸ç¦è›‹|normal","243|é›·å…¬|electric","244|ç‚å¸|fire","245|æ°´å›|water","248|ç­åŸºæ‹‰æ–¯|rock|dark","249|æ´›å¥‡äº|psychic|flying","250|é³³ç‹|fire|flying",
            "254|èœ¥èœ´ç‹|grass","257|ç«ç„°é›|fire|fighting","260|å·¨æ²¼æ€ª|water|ground","262|å¤§ç‹¼çŠ¬|dark","264|ç›´è¡ç†Š|normal","267|ç‹©çµé³³è¶|bug|flying","269|æ¯’ç²‰è›¾|bug|poison","272|æ¨‚å¤©æ²³ç«¥|water|grass","275|ç‹¡çŒ¾å¤©ç‹—|grass|dark","277|å¤§ç‹ç‡•|normal|flying","279|å¤§å˜´é·—|water|flying","282|æ²™å¥ˆæœµ|psychic|fairy","284|é›¨ç¿…è›¾|bug|flying","286|æ–—ç¬ è‡|grass|fighting","289|è«‹å‡ç‹|normal","291|éµé¢å¿è€…|bug|flying","292|è„«æ®¼å¿è€…|bug|ghost","295|çˆ†éŸ³æ€ª|normal","297|è¶…åŠ›ç‹|fighting","302|å‹¾é­‚çœ¼|dark|ghost","303|å¤§å˜´å¨ƒ|steel|fairy","306|æ³¢å£«å¯å¤šæ‹‰|steel|rock","308|æ°é›·å§†|fighting|psychic","310|é›·é›»ç¸|electric","311|æ­£é›»æ‹æ‹|electric","312|è² é›»æ‹æ‹|electric","313|é›»è¢èŸ²|bug","314|ç”œç”œè¢|bug","317|åé£Ÿç¸|poison","319|å·¨ç‰™é¯Š|water|dark","321|å¼é¯¨ç‹|water","323|å™´ç«é§|fire|ground","324|ç…¤ç‚­é¾œ|fire","326|å™—å™—è±¬|psychic","327|æ™ƒæ™ƒæ–‘|normal","330|æ²™æ¼ èœ»èœ“|ground|dragon","332|å¤¢æ­Œä»™äººæŒ|grass|dark","334|ä¸ƒå¤•é’é³¥|dragon|flying","335|è²“é¼¬æ–¬|normal","336|é£¯åŒ™è›‡|poison","337|æœˆçŸ³|rock|psychic","338|å¤ªé™½å²©|rock|psychic","340|é¯°é­šç‹|water|ground","342|éµè¯é¾è¦|water|dark","344|å¿µåŠ›åœŸå¶|ground|psychic","346|æ–ç±ƒç™¾åˆ|rock|grass","348|å¤ªå¤ç›”ç”²|rock|bug","350|ç¾ç´æ–¯|water","351|æ¼‚æµ®æ³¡æ³¡|normal","352|è®Šéš±é¾|normal","354|è©›å’’å¨ƒå¨ƒ|ghost","356|å½·å¾¨å¤œéˆ|ghost","357|ç†±å¸¶é¾|grass|flying","359|é˜¿å‹ƒæ¢­é­¯|dark","362|å†°é¬¼è­·|ice","365|å¸ç‰™æµ·ç…|ice|water","369|å¤ç©ºæ£˜é­š|water|rock","370|æ„›å¿ƒé­š|water","373|æš´é£›é¾|dragon|flying","376|å·¨é‡‘æ€ª|steel|psychic","377|é›·å‰æ´›å…‹|rock","378|é›·å‰è‰¾æ–¯|ice","379|é›·å‰æ–¯å¥‡é­¯|steel","380|æ‹‰å¸äºæ–¯|dragon|psychic","381|æ‹‰å¸æ­æ–¯|dragon|psychic","382|è“‹æ­å¡|water","383|å›ºæ‹‰å¤š|ground","384|çƒˆç©ºå|dragon|flying","386|ä»£æ­å¥‡å¸Œæ–¯|psychic",
            "389|åœŸå°é¾œ|grass|ground","392|çƒˆç„°çŒ´|fire|fighting","395|å¸ç‹æ‹¿æ³¢|water|steel","398|å§†å…‹é·¹|normal|flying","400|å¤§å°¾è²|normal|water","402|éŸ³ç®±èŸ€|bug","405|å€«ç´è²“|electric","407|ç¾…çµ²é›·æœµ|grass|poison","409|æˆ°æ§Œé¾|rock","411|è­·åŸé¾|rock|steel","413|çµè‰è²´å©¦(è‰)|bug|grass","414|ç´³å£«è›¾|bug|flying","416|èœ‚å¥³ç‹|bug|flying","419|æµ®æ½›é¼¬|water","421|æ«»èŠ±å…’|grass","424|é›™å°¾æ€ªæ‰‹|normal","426|éš¨é¢¨çƒ|ghost|flying","428|é•·è€³å…”|normal","429|å¤¢å¦–é­”|ghost","430|çƒé´‰é ­é ­|dark|flying","432|æ±æ–½å–µ|normal","435|å¦å…‹è‡­é¼¬|poison|dark","437|é’éŠ…é˜|steel|psychic","441|è’å™ªé³¥|normal|flying","442|èŠ±å²©æ€ª|ghost|dark","445|çƒˆå’¬é™¸é¯Š|dragon|ground","448|è·¯å¡åˆ©æ­|fighting|steel","450|æ²³é¦¬ç¸|ground","452|é¾ç‹è |poison|dark","454|æ¯’éª·è›™|poison|fighting","455|å°–ç‰™ç± |grass","457|éœ“è™¹é­š|water","460|æš´é›ªç‹|grass|ice","461|ç‘ªç‹ƒæ‹‰|dark|ice","462|è‡ªçˆ†ç£æ€ª|electric|steel","464|è¶…ç”²ç‹‚çŠ€|ground|rock","465|å·¨è”“è—¤|grass","466|é›»æ“Šé­”ç¸|electric","467|é´¨å˜´ç‚ç¸|fire","468|æ³¢å…‹åŸºæ–¯|fairy|flying","469|é å¤å·¨èœ“|bug|flying","472|å¤©è ç‹|ground|flying","473|è±¡ç‰™è±¬|ice|ground","474|å¤šé‚Šç¸Z|normal","475|è‰¾è·¯é›·æœµ|psychic|fighting","476|å¤§æœåŒ—é¼»|rock|steel","477|é»‘å¤œé­”éˆ|ghost","478|é›ªå¦–å¥³|ice|ghost","479|æ´›æ‰˜å§†(é›»é¬¼)|electric|ghost","483|å¸ç‰™ç›§å¡|steel|dragon","484|å¸•è·¯å¥‡äº|water|dragon","485|å¸­å¤šè—æ©|fire|steel","487|é¨æ‹‰å¸ç´(åˆ¥ç¨®)|ghost|dragon","488|å…‹é›·è‰²åˆ©äº|psychic","491|é”å…‹èŠä¼Š|dark","493|é˜¿çˆ¾å®™æ–¯|normal",
            "530|é¾é ­åœ°é¼ |ground|steel","534|ä¿®ç¹•è€é ­|fighting","545|èœˆèš£ç‹|bug|poison","547|é¢¨å¦–ç²¾|grass|fairy","553|æµæ°“é±·|ground|dark","555|é”æ‘©ç‹’ç‹’|fire","560|é ­å·¾æ··æ··|dark|fighting","561|è±¡å¾µé³¥|psychic|flying","563|æ­»ç¥æ£º|ghost","565|è‚‹éª¨æµ·é¾œ|water|rock","567|å§‹ç¥–å¤§é³¥|rock|flying","571|ç´¢ç¾…äºå…‹|dark","579|äººé€ ç´°èƒåµ|psychic","593|èƒ–å˜Ÿå˜Ÿ|water|ghost","596|é›»èœ˜è››|bug|electric","598|å …æœå•éˆ´|grass|steel","604|éº»éº»é°»é­šç‹|electric","609|æ°´æ™¶ç‡ˆç«éˆ|ghost|fire","612|é›™æ–§æˆ°é¾|dragon","620|å¸«çˆ¶é¼¬|fighting","623|æ³¥å¶å·¨äºº|ground|ghost","625|åŠˆæ–¬å¸ä»¤|dark|steel","628|å‹‡å£«é›„é·¹|normal|flying","630|ç¦¿é·¹å¨œ|dark|flying","635|ä¸‰é¦–æƒ¡é¾|dark|dragon","637|ç«ç¥è›¾|bug|fire","639|ä»£æ‹‰åŸºç¿|rock|fighting","641|é¾æ²é›²(åŒ–èº«)|flying","642|é›·æœé›²(åŒ–èº«)|electric|flying","645|åœŸåœ°é›²(åŒ–èº«)|ground|flying",
            "652|å¸ƒé‡Œå¡éš†|grass|fighting","655|å¦–ç«ç´…ç‹|fire|psychic","658|ç”²è³€å¿è›™|water|dark","660|æŒ–æ˜å…”|normal|ground","663|çƒˆç®­é·¹|fire|flying","666|å½©ç²‰è¶|bug|flying","673|åé¨å±±ç¾Š|grass","675|æµæ°“ç†Šè²“|fighting|dark","678|è¶…èƒ½å¦™å–µ|psychic","681|å …ç›¾åŠæ€ª|steel|ghost","687|çƒè³Šç‹|dark|psychic","691|æ¯’è—»é¾|poison|dragon","693|é‹¼ç‚®è‡‚è¦|water","697|æ€ªé¡é¾|rock|dragon","699|å†°é›ªå·¨é¾|rock|ice","700|ä»™å­ä¼Šå¸ƒ|fairy","701|æ‘”è§’é·¹äºº|fighting|flying","702|å’šå’šé¼ |electric|fairy","706|é»ç¾é¾|dragon","707|é‘°åœˆå…’|steel|fairy","709|æœ½æœ¨å¦–|ghost|grass","713|å†°å²©æ€ª|ice","715|éŸ³æ³¢é¾|flying|dragon","716|å“²çˆ¾å°¼äºæ–¯|fairy","717|ä¼Šè£´çˆ¾å¡”çˆ¾|dark|flying",
            "724|ç‹™å°„æ¨¹æ¢Ÿ|grass|ghost","727|ç†¾ç„°å’†å“®è™|fire|dark","730|è¥¿ç…æµ·å£¬|water|fairy","733|éŠƒå˜´å¤§é³¥|normal|flying","735|è²“é¼¬æ¢é•·|normal","738|é¬è¾²ç‚®èŸ²|bug|electric","740|å¥½å‹æ¯›èŸ¹|fighting|ice","743|è¶çµèŒè™»|bug|fairy","745|é¬ƒå²©ç‹¼äºº|rock","746|å¼±ä¸é­š|water","748|è¶…å£æ˜Ÿ|poison|water","750|é‡æ³¥æŒ½é¦¬|ground","752|æ»´è››éœ¸|water|bug","754|è˜­è³èŠ±|grass","758|ç„°åèœ¥|poison|fire","760|ç©¿è‘—ç†Š|normal|fighting","763|ç”œå†·ç¾å|grass","764|èŠ±ç™‚ç’°ç’°|fairy","765|æ™ºæ®çŒ©|normal|psychic","768|å…·ç”²æ­¦è€…|bug|water","770|å™¬æ²™å ¡çˆº|ghost|ground","773|éŠ€ä¼´æˆ°ç¸|normal","774|å°éš•æ˜Ÿ|rock|flying","775|æ¨¹æ•å°¾ç†Š|normal","776|çˆ†ç„°é¾œç¸|fire|dragon","777|æ‰˜æˆˆå¾·ç‘ªçˆ¾|electric|steel","778|è¬æ“¬Q|ghost|fairy","779|ç£¨ç‰™å½©çš®é­š|water|psychic","780|è€ç¿é¾|normal|dragon","781|ç ´ç ´èˆµè¼ª|ghost|grass","784|æ–å°¾é±—ç”²é¾|dragon|fighting","785|å¡ç’ãƒ»é³´é³´|electric|fairy",
            "812|è½Ÿæ“‚é‡‘å‰›çŒ©|grass","815|é–ƒç„°ç‹ç‰Œ|fire","818|åƒé¢é¿å½¹|water","820|è—é£½æ —é¼ |normal","823|é‹¼é§é´‰|flying|steel","826|ä»¥æ­è·¯æ™®|bug|psychic","832|æ¯›æ¯›è§’ç¾Š|normal","834|æš´å™¬é¾œ|water|rock","839|å·¨ç‚­å±±|rock|fire","842|è˜‹è£¹é¾|grass|dragon","845|å¤æœˆé³¥|flying|water","849|é¡«å¼¦è²|electric|poison","851|ç„šç„°èš£|fire|bug","853|å…«çˆªæ­¦å¸«|fighting","855|æ€–æ€å£º|ghost","858|å¸ƒè‰å§†æº«|psychic|fairy","861|é•·æ¯›å·¨é­”|dark|fairy","862|å µæ””ç†Š|dark|normal","865|è”¥éŠå…µ|fighting","869|éœœå¥¶ä»™|fairy","870|åˆ—é™£å…µ|fighting","871|å•ªåš“æµ·è†½|electric","873|é›ªçµ¨è›¾|ice|bug","874|å·¨çŸ³ä¸|rock","875|å†°ç Œéµ|ice","877|è«é­¯è²å¯|electric|dark","879|å¤§ç‹éŠ…è±¡|steel","884|é‹é‹¼é¾|steel|dragon","887|å¤šé¾å·´é­¯æ‰˜|dragon|ghost","892|æ­¦é“ç†Šå¸«(ä¸€æ“Š)|fighting|dark","905|çœ·æˆ€é›²(åŒ–èº«)|fairy|flying",
            "908|é­”å¹»å‡é¢å–µ|grass|dark","911|éª¨ç´‹å·¨è²é±·|fire|ghost","914|ç‹‚æ­¡æµªèˆé´¨|water|fighting","916|åœ˜ç è››|bug","923|å·´å¸ƒåœŸæ’¥|electric|fighting","925|ä¸€å®¶é¼ |normal","927|éº»èŠ±çŠ¬|fairy","930|å¥§åˆ©ç“¦|grass|normal","934|é¹½çŸ³å·¨éˆ|rock","936|ç´…è“®é§é¨|fire|psychic","937|è’¼ç‚åˆƒé¬¼|fire|ghost","941|é›»è‚šè›™|electric","943|ç’æ•™çˆ¶|dark","945|å¡—æ¨™å®¢|poison|normal","949|æ¯›å´–èŸ¹|rock","952|ç‹ è¾£æ¤’|grass|fire","959|ä¸‹çŸ³é³¥|flying|dark","962|æ™®éš†éš†å§†|steel|poison","964|æµ·è±šä¿ |water","966|æ™¶å…‰èŠ±|rock|poison","968|æ‘©æ‰˜èœ¥|dragon|normal","969|æ‹–æ‹–èš“|steel","975|é¯¨ç‹|ice","977|åƒå¼éœ¸|water","978|ç±³ç«‹é¾|dragon|water","979|æ£„ä¸–çŒ´|fighting|ghost","980|åœŸç‹|poison|ground","983|å¤§é›»æµ·ç‡•|electric|flying","987|æŒ¯ç¿¼é«®|ghost|fairy","988|çˆ¬åœ°ç¿…|bug|fighting","990|éµè½è·¡|ground|steel","992|éµè‡‚è†€|fighting|electric","993|éµé ¸é¾|dark|flying","996|éµæ£˜|rock|electric","997|éµæ­¦è€…|fairy|fighting","998|æˆŸè„Šé¾|dragon|ice","1000|è³½å¯Œè±ª|steel|ghost","1002|å¤åŠè±¹|dark|ice","1003|å¤é¼é¹¿|dark|ground","1004|å¤ç‰é­š|dark|fire","1005|å¤ç°¡è¸|dark|grass","1006|æ•…å‹’é “|fighting|dragon","1008|å¯†å‹’é “|electric|dragon","1017|å„é¬¼æ¤ª|grass",
            // å‹æ…‹è®ŠåŒ–
            "10004|çµè‰è²´å©¦(ç ‚åœŸ)|bug|ground","10005|çµè‰è²´å©¦(åƒåœ¾)|bug|steel","10006|è¬ç±³(å¤©ç©º)|grass|flying","10007|é¨æ‹‰å¸ç´(èµ·æº)|ghost|dragon",
            "10008|æ´›æ‰˜å§†(åŠ ç†±)|electric|fire","10009|æ´›æ‰˜å§†(æ¸…æ´—)|electric|water","10010|æ´›æ‰˜å§†(çµå†°)|electric|ice","10011|æ´›æ‰˜å§†(æ—‹è½‰)|electric|flying","10012|æ´›æ‰˜å§†(åˆ‡å‰²)|electric|grass",
            "10019|é¾æ²é›²(éˆç¸)|flying","10020|é›·æœé›²(éˆç¸)|electric|flying","10021|åœŸåœ°é›²(éˆç¸)|ground|flying","10249|çœ·æˆ€é›²(éˆç¸)|fairy|flying",
            "10086|èƒ¡å¸•(è§£æ”¾)|psychic|dark","10123|èŠ±èˆé³¥(å•ªæ»‹)|electric|flying","10124|èŠ±èˆé³¥(å‘¼æ‹‰)|psychic|flying","10125|èŠ±èˆé³¥(è¼•è¼•)|ghost|flying",
            "10191|æ­¦é“ç†Šå¸«(é€£æ“Š)|fighting|water","10193|è•¾å† ç‹(ç™½é¦¬)|psychic|ice","10194|è•¾å† ç‹(é»‘é¦¬)|psychic|ghost",
            // é˜¿ç¾…æ‹‰
            "10100|é›·ä¸˜(é˜¿ç¾…æ‹‰)|electric|psychic","10102|ç©¿å±±ç‹(é˜¿ç¾…æ‹‰)|ice|steel","10104|ä¹å°¾(é˜¿ç¾…æ‹‰)|ice|fairy","10106|ä¸‰åœ°é¼ (é˜¿ç¾…æ‹‰)|ground|steel","10108|è²“è€å¤§(é˜¿ç¾…æ‹‰)|dark","10111|éš†éš†å²©(é˜¿ç¾…æ‹‰)|rock|electric","10113|è‡­è‡­æ³¥(é˜¿ç¾…æ‹‰)|poison|dark","10114|æ¤°è›‹æ¨¹(é˜¿ç¾…æ‹‰)|grass|dragon","10115|å˜å•¦å˜å•¦(é˜¿ç¾…æ‹‰)|fire|ghost",
            // ä¼½å‹’çˆ¾
            "10163|çƒˆç„°é¦¬(ä¼½å‹’çˆ¾)|psychic|fairy","10165|å‘†æ®¼ç¸(ä¼½å‹’çˆ¾)|poison|psychic","10166|å¤§è”¥é´¨(ä¼½å‹’çˆ¾)|fighting","10167|é›™å½ˆç“¦æ–¯(ä¼½å‹’çˆ¾)|poison|fairy","10168|é­”ç‰†äººå¶(ä¼½å‹’çˆ¾)|ice|psychic","10170|æ€¥å‡é³¥(ä¼½å‹’çˆ¾)|psychic|flying","10171|é–ƒé›»é³¥(ä¼½å‹’çˆ¾)|fighting|flying","10172|ç«ç„°é³¥(ä¼½å‹’çˆ¾)|dark|flying","10173|å‘†å‘†ç‹(ä¼½å‹’çˆ¾)|poison|psychic","10174|å¤ªé™½çŠç‘š(ä¼½å‹’çˆ¾)|ghost","10176|ç›´è¡ç†Š(ä¼½å‹’çˆ¾)|dark|normal","10177|é”æ‘©ç‹’ç‹’(ä¼½å‹’çˆ¾)|ice","10180|æ³¥å·´é­š(ä¼½å‹’çˆ¾)|ground|steel",
            // æ´—ç¿ 
            "10230|é¢¨é€Ÿç‹—(æ´—ç¿ )|fire|rock","10232|é ‘çš®é›·å½ˆ(æ´—ç¿ )|electric|grass","10233|ç«çˆ†ç¸(æ´—ç¿ )|fire|ghost","10234|åƒé‡é­š(æ´—ç¿ )|dark|poison","10235|ç´æ‹‰(æ´—ç¿ )|fighting|poison","10236|å¤§åŠé¬¼(æ´—ç¿ )|water|dark","10237|è£™å…’å°å§(æ´—ç¿ )|grass|fighting","10239|ç´¢ç¾…äºå…‹(æ´—ç¿ )|normal|ghost","10240|å‹‡å£«é›„é·¹(æ´—ç¿ )|psychic|flying","10242|é»ç¾é¾(æ´—ç¿ )|steel|dragon","10243|å†°å²©æ€ª(æ´—ç¿ )|ice|rock","10244|ç‹™å°„æ¨¹æ¢Ÿ(æ´—ç¿ )|grass|fighting",
            // å¸•åº•äº
            "10250|è‚¯æ³°ç¾…(é¬¥)|fighting","10251|è‚¯æ³°ç¾…(é¬¥ç«)|fighting|fire","10252|è‚¯æ³°ç¾…(é¬¥æ°´)|fighting|water","10253|çƒæ³¢(å¸•åº•äº)|poison|ground"
        ];

        // === 2. MEGA é€²åŒ–è³‡æ–™ (ID æœ€çµ‚ä¿®æ­£) ===
        const MEGA_DATA = {
            3: [{ id: 10033, types: ['grass', 'poison'], name: 'Mega å¦™è›™èŠ±', suffix: 'Mega' }],
            6: [{ id: 10034, types: ['fire', 'dragon'], name: 'Mega å™´ç«é¾X', suffix: 'Mega X' }, { id: 10035, types: ['fire', 'flying'], name: 'Mega å™´ç«é¾Y', suffix: 'Mega Y' }],
            9: [{ id: 10036, types: ['water'], name: 'Mega æ°´ç®­é¾œ', suffix: 'Mega' }],
            15: [{ id: 10090, types: ['bug', 'poison'], name: 'Mega å¤§é‡èœ‚', suffix: 'Mega' }],
            18: [{ id: 10073, types: ['normal', 'flying'], name: 'Mega å¤§æ¯”é³¥', suffix: 'Mega' }],
            65: [{ id: 10037, types: ['psychic'], name: 'Mega èƒ¡åœ°', suffix: 'Mega' }],
            80: [{ id: 10071, types: ['water', 'psychic'], name: 'Mega å‘†æ®¼ç¸', suffix: 'Mega' }],
            94: [{ id: 10038, types: ['ghost', 'poison'], name: 'Mega è€¿é¬¼', suffix: 'Mega' }],
            115: [{ id: 10039, types: ['normal'], name: 'Mega è¢‹ç¸', suffix: 'Mega' }],
            127: [{ id: 10040, types: ['bug', 'flying'], name: 'Mega å‡±ç¾…æ–¯', suffix: 'Mega' }],
            130: [{ id: 10041, types: ['water', 'dark'], name: 'Mega æš´é¯‰é¾', suffix: 'Mega' }],
            142: [{ id: 10042, types: ['rock', 'flying'], name: 'Mega åŒ–çŸ³ç¿¼é¾', suffix: 'Mega' }],
            150: [{ id: 10043, types: ['psychic', 'fighting'], name: 'Mega è¶…å¤¢X', suffix: 'Mega X' }, { id: 10044, types: ['psychic'], name: 'Mega è¶…å¤¢Y', suffix: 'Mega Y' }],
            181: [{ id: 10045, types: ['electric', 'dragon'], name: 'Mega é›»é¾', suffix: 'Mega' }],
            208: [{ id: 10072, types: ['steel', 'ground'], name: 'Mega å¤§é‹¼è›‡', suffix: 'Mega' }],
            212: [{ id: 10046, types: ['bug', 'steel'], name: 'Mega å·¨é‰—è³è‚', suffix: 'Mega' }],
            214: [{ id: 10047, types: ['bug', 'fighting'], name: 'Mega èµ«æ‹‰å…‹ç¾…æ–¯', suffix: 'Mega' }],
            229: [{ id: 10048, types: ['dark', 'fire'], name: 'Mega é»‘é­¯åŠ ', suffix: 'Mega' }],
            248: [{ id: 10049, types: ['rock', 'dark'], name: 'Mega ç­åŸºæ‹‰æ–¯', suffix: 'Mega' }],
            254: [{ id: 10065, types: ['grass', 'dragon'], name: 'Mega èœ¥èœ´ç‹', suffix: 'Mega' }],
            257: [{ id: 10050, types: ['fire', 'fighting'], name: 'Mega ç«ç„°é›', suffix: 'Mega' }],
            260: [{ id: 10064, types: ['water', 'ground'], name: 'Mega å·¨æ²¼æ€ª', suffix: 'Mega' }],
            282: [{ id: 10051, types: ['psychic', 'fairy'], name: 'Mega æ²™å¥ˆæœµ', suffix: 'Mega' }],
            302: [{ id: 10066, types: ['dark', 'ghost'], name: 'Mega å‹¾é­‚çœ¼', suffix: 'Mega' }],
            303: [{ id: 10052, types: ['steel', 'fairy'], name: 'Mega å¤§å˜´å¨ƒ', suffix: 'Mega' }],
            306: [{ id: 10053, types: ['steel'], name: 'Mega æ³¢å£«å¯å¤šæ‹‰', suffix: 'Mega' }],
            308: [{ id: 10054, types: ['fighting', 'psychic'], name: 'Mega æ°é›·å§†', suffix: 'Mega' }],
            310: [{ id: 10055, types: ['electric'], name: 'Mega é›·é›»ç¸', suffix: 'Mega' }],
            319: [{ id: 10070, types: ['water', 'dark'], name: 'Mega å·¨ç‰™é¯Š', suffix: 'Mega' }],
            323: [{ id: 10087, types: ['fire', 'ground'], name: 'Mega å™´ç«é§', suffix: 'Mega' }],
            334: [{ id: 10067, types: ['dragon', 'fairy'], name: 'Mega ä¸ƒå¤•é’é³¥', suffix: 'Mega' }],
            354: [{ id: 10056, types: ['ghost'], name: 'Mega è©›å’’å¨ƒå¨ƒ', suffix: 'Mega' }],
            359: [{ id: 10057, types: ['dark'], name: 'Mega é˜¿å‹ƒæ¢­é­¯', suffix: 'Mega' }],
            362: [{ id: 10074, types: ['ice'], name: 'Mega å†°é¬¼è­·', suffix: 'Mega' }],
            373: [{ id: 10089, types: ['dragon', 'flying'], name: 'Mega æš´é£›é¾', suffix: 'Mega' }],
            376: [{ id: 10076, types: ['steel', 'psychic'], name: 'Mega å·¨é‡‘æ€ª', suffix: 'Mega' }],
            380: [{ id: 10062, types: ['dragon', 'psychic'], name: 'Mega æ‹‰å¸äºæ–¯', suffix: 'Mega' }],
            381: [{ id: 10063, types: ['dragon', 'psychic'], name: 'Mega æ‹‰å¸æ­æ–¯', suffix: 'Mega' }],
            384: [{ id: 10079, types: ['dragon', 'flying'], name: 'Mega çƒˆç©ºå', suffix: 'Mega' }], // Fixed
            428: [{ id: 10088, types: ['normal', 'fighting'], name: 'Mega é•·è€³å…”', suffix: 'Mega' }], // Fixed: 10088
            445: [{ id: 10058, types: ['dragon', 'ground'], name: 'Mega çƒˆå’¬é™¸é¯Š', suffix: 'Mega' }],
            448: [{ id: 10059, types: ['fighting', 'steel'], name: 'Mega è·¯å¡åˆ©æ­', suffix: 'Mega' }],
            460: [{ id: 10060, types: ['grass', 'ice'], name: 'Mega æš´é›ªç‹', suffix: 'Mega' }],
            475: [{ id: 10068, types: ['psychic', 'fighting'], name: 'Mega è‰¾è·¯é›·æœµ', suffix: 'Mega' }],
            531: [{ id: 10069, types: ['normal', 'fairy'], name: 'Mega å·®ä¸å¤šå¨ƒå¨ƒ', suffix: 'Mega' }],
            719: [{ id: 10075, types: ['rock', 'fairy'], name: 'Mega è’‚å®‰å¸Œ', suffix: 'Mega' }]
        };

        // === 3. æ•´åˆè³‡æ–™åº« ===
        const POKEMON_DB = RAW_DATA.map(str => { 
            const p = str.split('|'); 
            const id = parseInt(p[0]);
            const obj = { id: id, name: p[1], types: p.slice(2) };
            if (MEGA_DATA[id]) obj.megas = MEGA_DATA[id];
            obj.activeForm = null;
            return obj;
        });

        const ENEMY_POOL = [...POKEMON_DB];
        Object.values(MEGA_DATA).forEach(megaList => {
            megaList.forEach(m => {
                ENEMY_POOL.push({ id: m.id, name: m.name, types: m.types });
            });
        });
        // è¿½åŠ  Primal
        ENEMY_POOL.push({id:10077, name:'åŸå§‹è“‹æ­å¡', types:['water']});
        ENEMY_POOL.push({id:10078, name:'åŸå§‹å›ºæ‹‰å¤š', types:['ground','fire']});

        const TYPES = ['normal', 'fire', 'water', 'grass', 'electric', 'ice', 'fighting', 'poison', 'ground', 'flying', 'psychic', 'bug', 'rock', 'ghost', 'dragon', 'steel', 'dark', 'fairy'];
        const TYPE_ICONS = { normal: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/normal.svg', fire: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/fire.svg', water: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/water.svg', grass: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/grass.svg', electric: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/electric.svg', ice: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/ice.svg', fighting: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/fighting.svg', poison: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/poison.svg', ground: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/ground.svg', flying: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/flying.svg', psychic: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/psychic.svg', bug: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/bug.svg', rock: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/rock.svg', ghost: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/ghost.svg', dragon: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/dragon.svg', steel: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/steel.svg', dark: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/dark.svg', fairy: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/fairy.svg' };
        const TYPE_NAMES = { 'normal':'ä¸€èˆ¬', 'fire':'ç«', 'water':'æ°´', 'grass':'è‰', 'electric':'é›»', 'ice':'å†°', 'fighting':'æ ¼é¬¥', 'poison':'æ¯’', 'ground':'åœ°é¢', 'flying':'é£›è¡Œ', 'psychic':'è¶…èƒ½', 'bug':'èŸ²', 'rock':'å²©çŸ³', 'ghost':'å¹½éˆ', 'dragon':'é¾', 'steel':'é‹¼', 'dark':'æƒ¡', 'fairy':'å¦–ç²¾' };
        const TYPE_CHART = { normal: { rock: 0.5, ghost: 0, steel: 0.5 }, fire: { fire: 0.5, water: 0.5, grass: 2, ice: 2, bug: 2, rock: 0.5, dragon: 0.5, steel: 2 }, water: { fire: 2, water: 0.5, grass: 0.5, ground: 2, rock: 2, dragon: 0.5 }, grass: { fire: 0.5, water: 2, grass: 0.5, poison: 0.5, ground: 2, flying: 0.5, bug: 0.5, rock: 2, dragon: 0.5, steel: 0.5 }, electric: { water: 2, grass: 0.5, electric: 0.5, ground: 0, flying: 2, dragon: 0.5 }, ice: { fire: 0.5, water: 0.5, grass: 2, ice: 0.5, ground: 2, flying: 2, dragon: 2, steel: 0.5 }, fighting: { normal: 2, ice: 2, poison: 0.5, flying: 0.5, psychic: 0.5, bug: 0.5, rock: 2, ghost: 0, dark: 2, steel: 2, fairy: 0.5 }, poison: { grass: 2, poison: 0.5, ground: 0.5, rock: 0.5, ghost: 0.5, steel: 0, fairy: 2 }, ground: { fire: 2, grass: 0.5, electric: 2, poison: 2, flying: 0, bug: 0.5, rock: 2, steel: 2 }, flying: { grass: 2, electric: 0.5, fighting: 2, bug: 2, rock: 0.5, steel: 0.5 }, psychic: { fighting: 2, poison: 2, psychic: 0.5, dark: 0, steel: 0.5 }, bug: { fire: 0.5, grass: 2, fighting: 0.5, poison: 0.5, flying: 0.5, psychic: 2, ghost: 0.5, dark: 2, steel: 0.5, fairy: 0.5 }, rock: { fire: 2, ice: 2, fighting: 0.5, ground: 0.5, flying: 2, bug: 2, steel: 0.5 }, ghost: { normal: 0, psychic: 2, ghost: 2, dark: 0.5 }, dragon: { dragon: 2, steel: 0.5, fairy: 0 }, steel: { fire: 0.5, water: 0.5, electric: 0.5, ice: 2, rock: 2, steel: 0.5, fairy: 2 }, dark: { fighting: 0.5, psychic: 2, ghost: 2, dark: 0.5, fairy: 0.5 }, fairy: { fire: 0.5, fighting: 2, poison: 0.5, dragon: 2, dark: 2, steel: 0.5 } };

        function getIconHtml(t, m=false) { const w=m?'type-icon-wrapper mini-icon-wrapper':'type-icon-wrapper', s=m?'type-icon-svg mini-icon-svg':'type-icon-svg'; return `<div class="${w} bg-${t}"><img src="${TYPE_ICONS[t]}" class="${s}"></div>`; }

        class Game {
            constructor() {
                this.mode = 'attack'; this.rounds = 10; this.currRound = 0; 
                this.playerTeam = []; this.selectedTypes = new Set(); 
                this.selectedPokemon = null; this.isMegaActive = false;
                this.currentDraftFilter = 'all'; this.soundEnabled = true;
                this.initTypeUI(); this.generateTypeChart();
            }
            toggleSound() { this.soundEnabled = !this.soundEnabled; const btn = document.getElementById('btn-sound'); if (this.soundEnabled) { btn.textContent = 'ğŸ”Š é–‹å•Ÿ'; btn.classList.remove('muted'); } else { btn.textContent = 'ğŸ”‡ éœéŸ³'; btn.classList.add('muted'); } }
            playCry(id) { if (!this.soundEnabled) return; const audio = new Audio(`https://raw.githubusercontent.com/PokeAPI/cries/main/cries/pokemon/latest/${id}.ogg`); audio.volume = 0.4; audio.play().catch(e => {}); }
            
            updateMegaButton() {
                const container = document.getElementById('mega-controls');
                container.innerHTML = ''; 
                if (this.mode === 'team' && this.selectedPokemon && this.selectedPokemon.megas) {
                    this.selectedPokemon.megas.forEach((mega, index) => {
                        const btn = document.createElement('button');
                        let btnClass = 'mega-btn visible';
                        if (mega.suffix.includes('X')) btnClass += ' mega-x';
                        else if (mega.suffix.includes('Y')) btnClass += ' mega-y';
                        else btnClass += ' mega-gen';
                        if (this.selectedPokemon.activeForm === index) btnClass += ' active';
                        btn.className = btnClass;
                        btn.innerHTML = `<img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/key-stone.png"> ${mega.suffix}`;
                        btn.onclick = () => this.toggleMega(index);
                        container.appendChild(btn);
                    });
                }
            }

            toggleMega(formIndex) {
                if (!this.selectedPokemon) return;
                if (this.selectedPokemon.activeForm === formIndex) this.selectedPokemon.activeForm = null;
                else this.selectedPokemon.activeForm = formIndex;
                this.updateMegaButton();
                this.refreshCardDisplay();
            }

            refreshCardDisplay() {
                const card = document.querySelector('.team-card.selected');
                if (!card) return;
                const p = this.selectedPokemon;
                let displayId = p.id;
                let displayTypes = p.types;
                if (p.activeForm !== null) {
                    const mega = p.megas[p.activeForm];
                    displayId = mega.id;
                    displayTypes = mega.types;
                    this.playCry(displayId);
                } else {
                    this.playCry(p.id);
                }
                const img = card.querySelector('img');
                img.src = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${displayId}.png`;
                const badgesContainer = card.querySelector('div:last-child');
                badgesContainer.innerHTML = displayTypes.map(t => `<span class="type-badge-text bg-${t}">${getIconHtml(t, true)} ${TYPE_NAMES[t]}</span>`).join('');
            }

            generateTypeChart() { const c = document.getElementById('chart-container'); let h = '<table class="chart-table"><thead><tr class="chart-header"><th>æ”»\\å®ˆ</th>'; TYPES.forEach(t => h += `<th><div class="type-icon-wrapper bg-${t}" style="width:20px;height:20px;margin:0;"><img src="${TYPE_ICONS[t]}" class="type-icon-svg" style="width:12px;height:12px;"></div></th>`); h += '</tr></thead><tbody>'; TYPES.forEach(atk => { h += `<tr><td class="chart-side-header"><div class="type-icon-wrapper bg-${atk}" style="width:20px;height:20px;margin:0;"><img src="${TYPE_ICONS[atk]}" class="type-icon-svg" style="width:12px;height:12px;"></div></td>`; TYPES.forEach(def => { let v = 1; if(TYPE_CHART[atk] && TYPE_CHART[atk][def] !== undefined) v = TYPE_CHART[atk][def]; let cl = '', ct = ''; if(v===2){cl='cell-2x';ct='2';}else if(v===0.5){cl='cell-05x';ct='Â½';}else if(v===0){cl='cell-0x';ct='0';} h += `<td class="${cl}">${ct}</td>`; }); h += '</tr>'; }); h += '</tbody></table>'; c.innerHTML = h; }
            toggleChart() { const m = document.getElementById('modal-chart'); m.style.display = m.style.display === 'flex' ? 'none' : 'flex'; }
            initTypeUI() { const g = document.getElementById('ui-types'); TYPES.forEach(t => { const b = document.createElement('div'); b.className = `game-btn bg-${t}`; b.innerHTML = `${getIconHtml(t)} ${TYPE_NAMES[t]}`; b.onclick = () => this.toggleType(t, b); g.appendChild(b); }); }
            toggleType(t, b) { if(document.getElementById('btn-submit').disabled) return; if (this.selectedTypes.has(t)) { this.selectedTypes.delete(t); b.classList.remove('selected'); } else { if (this.selectedTypes.size >= 2) { alert("æœ€å¤šé¸2å€‹"); return; } this.selectedTypes.add(t); b.classList.add('selected'); } }
            initMode(m) { this.mode = m; document.querySelectorAll('.container').forEach(c => c.classList.remove('active')); if (m === 'team') this.startDraft(); else this.startGame(); }
            quitToMenu() { if (confirm("å›åˆ°ä¸»é¸å–®ï¼Ÿ")) { document.querySelectorAll('.container').forEach(c => c.classList.remove('active')); document.getElementById('screen-menu').classList.add('active'); } }
            
            startDraft() { document.getElementById('screen-draft').classList.add('active'); this.playerTeam = []; this.currentDraftFilter = 'all'; this.initDraftSidebar(); this.renderDraftGrid(); this.updateDraftStatus(); }
            randomDraft() { this.playerTeam = []; let a = [...POKEMON_DB]; a.sort(() => Math.random() - 0.5); let u = new Set(); for (let p of a) { if (this.playerTeam.length >= 6) break; let uniq = true; for (let t of p.types) { if (u.has(t) && p.types.indexOf(t) === 0) uniq = false; } if (uniq || this.playerTeam.length < 2) { this.playerTeam.push({ ...p, activeForm: null }); p.types.forEach(t => u.add(t)); } } if (this.playerTeam.length < 6) { let r = a.filter(p => !this.playerTeam.some(existing => existing.id === p.id)); while(this.playerTeam.length < 6 && r.length > 0) this.playerTeam.push({ ...r.pop(), activeForm: null }); } this.updateDraftStatus(); this.renderDraftGrid(); }
            initDraftSidebar() { const s = document.getElementById('draft-filter-list'); s.innerHTML = ''; const all = document.createElement('div'); all.className = 'filter-btn active'; all.textContent = 'å…¨éƒ¨é¡¯ç¤º'; all.onclick = () => this.setDraftFilter('all', all); s.appendChild(all); TYPES.forEach(t => { const b = document.createElement('div'); b.className = 'filter-btn'; b.innerHTML = `${getIconHtml(t, true)} ${TYPE_NAMES[t]}`; b.style.borderLeft = `4px solid #ccc`; b.onclick = () => this.setDraftFilter(t, b); s.appendChild(b); }); }
            setDraftFilter(t, b) { this.currentDraftFilter = t; document.querySelectorAll('.filter-btn').forEach(x => x.classList.remove('active')); b.classList.add('active'); this.renderDraftGrid(); }
            renderDraftGrid() { const g = document.getElementById('draft-grid'); g.innerHTML = ''; const l = this.currentDraftFilter === 'all' ? POKEMON_DB : POKEMON_DB.filter(p => p.types.includes(this.currentDraftFilter)); l.forEach(p => { const c = document.createElement('div'); c.className = 'draft-card'; if (this.playerTeam.some(x => x.id === p.id)) c.classList.add('picked'); if(p.megas) { const m = document.createElement('div'); m.className='mega-indicator'; c.appendChild(m); } const dots = p.types.map(t => `<span class="mini-type-dot bg-${t}"></span>`).join(' '); c.innerHTML += `<img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${p.id}.png" loading="lazy"><div class="draft-name">${p.name}</div><div class="draft-types">${dots}</div>`; c.onclick = () => { this.playCry(p.id); if (this.playerTeam.some(x => x.id === p.id)) { this.playerTeam = this.playerTeam.filter(x => x.id !== p.id); c.classList.remove('picked'); } else { if (this.playerTeam.length >= 6) return; this.playerTeam.push({ ...p, activeForm: null }); c.classList.add('picked'); } this.updateDraftStatus(); }; g.appendChild(c); }); }
            updateDraftStatus() { document.getElementById('draft-count').textContent = this.playerTeam.length; const b = document.getElementById('btn-start-team'); if (this.playerTeam.length === 6) { b.disabled = false; b.style.backgroundColor = '#4caf50'; b.style.cursor = 'pointer'; } else { b.disabled = true; b.style.backgroundColor = '#555'; b.style.cursor = 'not-allowed'; } }
            finishDraft() { this.startGame(); }
            
            startGame() { 
                document.querySelectorAll('.container').forEach(c => c.classList.remove('active')); 
                document.getElementById('screen-game').classList.add('active'); 
                const t = document.getElementById('ui-types'); const tm = document.getElementById('ui-team'); 
                const megaControls = document.getElementById('mega-controls');
                if (this.mode === 'team') { 
                    t.style.display = 'none'; tm.style.display = 'grid'; megaControls.style.display = 'flex';
                    this.renderBattleTeam(); 
                } else { 
                    t.style.display = 'grid'; tm.style.display = 'none'; megaControls.style.display = 'none';
                } 
                this.currRound = 0; this.nextRound(); 
            }
            
            renderBattleTeam() { 
                const g = document.getElementById('ui-team'); g.innerHTML = ''; 
                this.playerTeam.forEach(p => { 
                    const c = document.createElement('div'); c.className = 'team-card'; 
                    const b = p.types.map(t => `<span class="type-badge-text bg-${t}">${getIconHtml(t, true)} ${TYPE_NAMES[t]}</span>`).join(''); 
                    c.innerHTML = `<img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${p.id}.png" style="width:60px;height:60px;"><div style="font-size:0.8em;font-weight:bold">${p.name}</div><div style="display:flex;justify-content:center;margin-top:2px;flex-wrap:wrap;">${b}</div>`; 
                    c.onclick = () => { 
                        if(document.getElementById('btn-submit').style.display === 'none') return; 
                        document.querySelectorAll('.team-card').forEach(x=>x.classList.remove('selected')); 
                        c.classList.add('selected');
                        this.selectedPokemon = p; 
                        // æ’­æ”¾å°æ‡‰ç‹€æ…‹çš„å«è²
                        const currentId = (p.activeForm !== null) ? p.megas[p.activeForm].id : p.id;
                        this.playCry(currentId);
                        this.updateMegaButton();
                    }; 
                    g.appendChild(c); 
                }); 
            }

            nextRound() { 
                if (this.currRound >= this.rounds) { this.endGame(); return; } 
                this.currRound++; document.getElementById('round-current').textContent = this.currRound; 
                this.selectedTypes.clear(); this.selectedPokemon = null; 
                document.getElementById('mega-controls').innerHTML = '';
                document.querySelectorAll('.game-btn').forEach(b => b.classList.remove('selected')); 
                document.querySelectorAll('.team-card').forEach(c => { c.classList.remove('selected'); });

                this.enemy = ENEMY_POOL[Math.floor(Math.random() * ENEMY_POOL.length)]; 
                // åç¨±é˜²é›·è™•ç†ï¼šéš±è—æ‹¬è™Ÿå…§å®¹
                document.getElementById('enemy-name').textContent = this.enemy.name.split('(')[0]; 
                
                const img = document.getElementById('enemy-img'); img.style.opacity = '0'; 
                img.src = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${this.enemy.id}.png`; 
                document.getElementById('enemy-name').style.opacity = '0'; 
                document.getElementById('enemy-reveal').innerHTML = `<span style="color:#777">??? å±¬æ€§ ???</span>`; 
                let hint = ""; 
                if (this.mode === 'team') hint = "è«‹æ´¾å‡ºå¯¶å¯å¤¢ï¼"; 
                else if (this.mode === 'attack') hint = "è«‹é¸æ“‡ å‰‹åˆ¶ å®ƒçš„å±¬æ€§ï¼"; 
                else hint = "è«‹é¸æ“‡ æŠµæŠ— å®ƒçš„å±¬æ€§ï¼"; 
                document.getElementById('round-log').innerHTML = hint; 
                document.getElementById('btn-submit').style.display = 'inline-block'; 
                document.getElementById('btn-next').style.display = 'none'; 
                
                setTimeout(() => { 
                    img.style.opacity = '1'; document.getElementById('enemy-name').style.opacity = '1'; 
                    this.playCry(this.enemy.id); 
                }, 1000); 
            }
            
            calcDmg(atk, defs) { let m = 1; defs.forEach(d => { if(TYPE_CHART[atk] && TYPE_CHART[atk][d]!=undefined) m *= TYPE_CHART[atk][d]; }); return m; }
            
            submit() {
                if (this.mode === 'team' && !this.selectedPokemon) { alert("è«‹é¸å¯¶å¯å¤¢"); return; }
                if (this.mode !== 'team' && this.selectedTypes.size === 0) { alert("è«‹é¸å±¬æ€§"); return; }
                
                const reveal = document.getElementById('enemy-reveal');
                reveal.innerHTML = this.enemy.types.map(t => `<span class="type-badge-text bg-${t}">${getIconHtml(t, true)} ${TYPE_NAMES[t]}</span>`).join('');
                document.getElementById('enemy-name').textContent = this.enemy.name;

                let log = "";
                const getPDesc = (m) => m===0 ? "<span class='text-immune'>æ”»æ“Šç„¡æ•ˆ</span>" : (m<1 ? "<span class='text-weak'>æ•ˆæœä¸å¥½</span>" : (m===1 ? "<span class='text-normal'>æ•ˆæœæ™®é€š</span>" : "<span class='text-super'>æ•ˆæœçµ•ä½³</span>"));
                const getEDesc = (m) => m===0 ? "<span class='text-perfect'>å®Œç¾å…ç–«</span>" : (m<1 ? "<span class='text-weak'>æŠµæŠ—æˆåŠŸ</span>" : (m===1 ? "<span class='text-normal'>æ•ˆæœæ™®é€š</span>" : "<span class='text-super'>è¢«å‰‹åˆ¶</span>"));

                if (this.mode === 'attack') {
                    let max = 0; this.selectedTypes.forEach(t => { const v = this.calcDmg(t, this.enemy.types); if(v>max) max=v; });
                    log = max>=4 ? "<span class='text-super'>æ•ˆæœçµ•ä½³ï¼ï¼ (x4)</span>" : (max>1 ? "<span class='text-super'>æ•ˆæœçµ•ä½³ (x2)</span>" : "<span class='text-immune'>æ•ˆæœä¸å¥½/ç„¡æ•ˆ...</span>");
                } else if (this.mode === 'defense') {
                    let details = []; const defs = Array.from(this.selectedTypes);
                    this.enemy.types.forEach(et => {
                        const v = this.calcDmg(et, defs);
                        details.push(`<div class="defense-row"><span class="type-badge-text bg-${et}">${getIconHtml(et, true)} ${TYPE_NAMES[et]}</span><span> æ”»æ“Š âœ </span>${getEDesc(v)} (x${v})</div>`);
                    });
                    log = details.join('');
                } else {
                    let myTypes = this.selectedPokemon.types;
                    let myName = this.selectedPokemon.name;
                    if (this.selectedPokemon.activeForm !== null) {
                        const mega = this.selectedPokemon.megas[this.selectedPokemon.activeForm];
                        myTypes = mega.types;
                        myName = mega.name;
                    }

                    let myMax = 0; myTypes.forEach(t => { const v = this.calcDmg(t, this.enemy.types); if(v>myMax) myMax=v; });
                    let enMax = 0; this.enemy.types.forEach(t => { const v = this.calcDmg(t, myTypes); if(v>enMax) enMax=v; });
                    
                    log = `<div class="result-grid">
                        <div class="result-col"><div class="result-val">æˆ‘æ–¹(${myName})æ”»æ“Š x${myMax}</div><div class="result-desc">${getPDesc(myMax)}</div></div>
                        <div class="result-divider">|</div>
                        <div class="result-col"><div class="result-val">æ•µæ–¹æ”»æ“Š x${enMax}</div><div class="result-desc">${getEDesc(enMax)}</div></div>
                    </div>`;
                    if (myMax > 1 && enMax < 1) log += `<div style="margin-top:10px"><span class="text-perfect">â˜… å®Œç¾æ”»é˜²ï¼(+4) â˜…</span></div>`;
                }
                document.getElementById('round-log').innerHTML = log;
                document.getElementById('btn-submit').style.display = 'none';
                document.getElementById('btn-next').style.display = 'inline-block';
            }
            endGame() { document.querySelectorAll('.container').forEach(c => c.classList.remove('active')); document.getElementById('screen-result').classList.add('active'); }

            // === 4. Gallery / Debug åŠŸèƒ½ ===
            openGallery() {
                document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
                document.getElementById('screen-gallery').classList.add('active');
                
                const container = document.getElementById('gallery-container');
                container.innerHTML = ''; 

                const megas = [];
                Object.values(MEGA_DATA).forEach(list => {
                    list.forEach(m => megas.push(m));
                });
                // åŠ å…¥åŸå§‹å›æ­¸ä»¥ä¾›æª¢æŸ¥
                megas.push({id:10077, name:'åŸå§‹è“‹æ­å¡', types:['water']});
                megas.push({id:10078, name:'åŸå§‹å›ºæ‹‰å¤š', types:['ground','fire']});

                megas.forEach(m => {
                    const card = document.createElement('div');
                    card.className = 'gallery-card';
                    const badges = m.types.map(t => `<span class="mini-type-dot bg-${t}"></span>`).join(' ');
                    card.innerHTML = `
                        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${m.id}.png" loading="lazy">
                        <div class="gallery-name">${m.name}</div>
                        <div class="gallery-id">ID: ${m.id}</div>
                        <div style="display:flex;gap:2px">${badges}</div>
                    `;
                    container.appendChild(card);
                });
            }
        }
        const game = new Game();
    </script>
</body>
</html>
