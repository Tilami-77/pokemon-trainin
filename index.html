<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¶å¯å¤¢æˆ°è¡“ç‰¹è¨“ - è²å…‰æ•ˆæœç‰ˆ</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --sidebar-bg: #f8f9fa;
            --btn-exit: #90a4ae;
            --btn-random: #7e57c2;
            --btn-chart: #0288d1;
            --btn-sound: #e91e63;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            user-select: none;
        }

        /* Header å€åŸŸ */
        .header-bar {
            width: 100%;
            max-width: 850px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin: 10px 0;
            min-height: 40px;
        }

        h1 { margin: 0; color: #333; font-size: 1.4em; }

        /* å³ä¸Šè§’æŒ‰éˆ•ç¾¤çµ„ */
        .header-controls {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 8px;
        }

        .header-btn {
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.85em;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .btn-chart { background-color: var(--btn-chart); }
        .btn-chart:hover { background-color: #0277bd; }
        
        .btn-sound { background-color: var(--btn-sound); width: 90px; justify-content: center; }
        .btn-sound:hover { background-color: #c2185b; }
        .btn-sound.muted { background-color: #9e9e9e; }

        /* é€šç”¨å®¹å™¨ */
        .container {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 850px;
            text-align: center;
            display: none;
            box-sizing: border-box;
        }
        .active { display: block !important; }

        /* ç‹€æ…‹åˆ— */
        .status-bar {
            display: flex;
            justify-content: flex-end;
            background: #eee;
            padding: 8px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-weight: bold;
            color: #555;
        }

        /* æˆ°è¡“å›é¥‹æ–‡å­— */
        .text-super { color: #d32f2f; font-weight: bold; font-size: 1.1em; }
        .text-weak { color: #1976d2; font-weight: bold; }
        .text-immune { color: #616161; font-weight: bold; }
        .text-perfect { color: #f57f17; font-weight: bold; font-size: 1.2em; text-shadow: 0 0 5px rgba(245, 127, 23, 0.2); }
        .text-normal { color: #555; font-weight: bold; }

        /* å®˜æ–¹é¢¨æ ¼å±¬æ€§åœ–æ¨™ (SVG) */
        .type-icon-wrapper {
            display: inline-flex; align-items: center; justify-content: center;
            width: 24px; height: 24px; border-radius: 50%; vertical-align: middle; margin-right: 5px;
            box-shadow: 1px 1px 2px rgba(0,0,0,0.2); flex-shrink: 0;
        }
        .type-icon-svg { width: 14px; height: 14px; filter: brightness(0) invert(1); }

        /* å¯¦å¿ƒåœ“é» (é¸è§’åˆ—è¡¨ç”¨) */
        .mini-type-dot {
            width: 14px; height: 14px; border-radius: 50%; display: inline-block; margin: 2px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.15);
        }

        /* å°æŠ„ Modal */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 999; display: none;
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; width: 95%; max-width: 800px; height: 85%;
            border-radius: 10px; padding: 10px; display: flex; flex-direction: column;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .modal-header {
            display: flex; justify-content: space-between; align-items: center;
            padding-bottom: 10px; border-bottom: 1px solid #eee; margin-bottom: 10px;
        }
        .modal-body { flex: 1; overflow: auto; }
        .chart-table { border-collapse: collapse; width: 100%; font-size: 0.8em; }
        .chart-table th, .chart-table td { border: 1px solid #e0e0e0; padding: 4px; text-align: center; min-width: 25px; }
        .chart-header { position: sticky; top: 0; background: #fff; z-index: 2; }
        .chart-side-header { position: sticky; left: 0; background: #fff; z-index: 1; }
        .cell-2x { background-color: #ffebee; color: #d32f2f; font-weight: bold; }
        .cell-05x { background-color: #e3f2fd; color: #1976d2; }
        .cell-0x { background-color: #eee; color: #757575; }

        /* éšŠä¼é¸æ“‡ä»‹é¢ */
        .draft-layout { display: flex; height: 480px; gap: 15px; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; margin-bottom: 15px; }
        .draft-sidebar { width: 140px; background: var(--sidebar-bg); overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 5px; border-right: 1px solid #ddd; }
        .draft-main { flex: 1; overflow-y: auto; padding: 15px; background: #fff; }
        .draft-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 12px; }

        @media (max-width: 600px) {
            .draft-layout { flex-direction: column; height: 550px; }
            .draft-sidebar { width: 100%; height: 80px; flex-direction: row; overflow-x: auto; border-right: none; border-bottom: 1px solid #ddd; white-space: nowrap; }
            .filter-btn { min-width: 90px; }
            .draft-grid { grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); }
        }

        .filter-btn { padding: 8px; border: 1px solid #ccc; border-radius: 5px; font-size: 0.9em; cursor: pointer; background: #fff; color: #333; display: flex; align-items: center; justify-content: center; gap: 6px; transition: background 0.2s; }
        .filter-btn.active { background: #333; color: #fff; border-color: #333; }

        .draft-card { border: 1px solid #eee; border-radius: 8px; padding: 10px 5px; cursor: pointer; background: #fff; display: flex; flex-direction: column; align-items: center; position: relative; transition: transform 0.1s, box-shadow 0.1s; min-height: 115px; justify-content: flex-start; gap: 6px; }
        .draft-card:hover { background: #f9f9f9; transform: translateY(-2px); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .draft-card.picked { background-color: #e8f5e9; border-color: #4caf50; box-shadow: 0 0 0 2px #4caf50; opacity: 1; }
        .draft-card.picked::after { content: 'âœ”'; position: absolute; top: 4px; right: 4px; background: #4caf50; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 12px; display: flex; align-items: center; justify-content: center; z-index: 2; }
        .draft-card img { width: 65px; height: 65px; object-fit: contain; flex-shrink: 0; }
        .draft-name { font-size: 0.85em; font-weight: bold; text-align: center; line-height: 1.2; width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #333; }
        .draft-types { display: flex; gap: 4px; justify-content: center; flex-wrap: wrap; width: 100%; }

        /* æˆ°é¬¥ç•«é¢ */
        .enemy-display { margin: 15px 0; min-height: 150px; display: flex; flex-direction: column; align-items: center; justify-content: center;}
        
        /* å¯¶å¯å¤¢åœ–ç‰‡ - å¢åŠ éæ¸¡æ•ˆæœ */
        .enemy-img { 
            width: 140px; height: 140px; 
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.2));
            opacity: 0; /* é è¨­éš±è— */
            transition: opacity 0.5s ease-in; /* æ¼¸ç¾æ•ˆæœ */
        }
        
        .type-badge-text { padding: 4px 10px; border-radius: 20px; color: white; font-size: 0.9em; font-weight: bold; margin: 0 2px; display: inline-flex; align-items: center; gap: 5px; }

        .battle-team-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
        .team-card { background: #f9f9f9; border: 2px solid #eee; border-radius: 8px; padding: 8px; cursor: pointer; transition: transform 0.1s; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .team-card:active { transform: scale(0.95); }
        .team-card.selected { border-color: #333; background: #e0e0e0; box-shadow: 0 0 5px rgba(0,0,0,0.2); }

        .grid-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 10px; }
        @media(min-width: 500px) { .grid-container { grid-template-columns: repeat(6, 1fr); } }

        .game-btn { padding: 8px; border: 2px solid transparent; border-radius: 6px; color: white; cursor: pointer; font-weight: bold; font-size: 0.95em; display: flex; align-items: center; justify-content: center; gap: 6px; }
        .game-btn.selected { border-color: #333; transform: scale(1.05); box-shadow: 0 0 5px rgba(0,0,0,0.3); }

        /* æŒ‰éˆ•ç¾¤ */
        .action-btn { width: 100%; padding: 12px; font-size: 1.1em; color: white; border: none; border-radius: 8px; margin-top: 10px; cursor: pointer; font-weight: bold; }
        .btn-menu { background-color: #3f51b5; margin-bottom: 10px; }
        .btn-confirm { background-color: #333; }
        .btn-next { background-color: #4caf50; display: none; }
        .btn-exit { background-color: var(--btn-exit); margin-top: 15px; }
        .btn-exit:hover { background-color: #78909c; }
        .btn-random { background-color: var(--btn-random); margin-bottom: 10px; }
        .btn-random:hover { background-color: #673ab7; }

        /* å±¬æ€§é¡è‰² */
        .bg-normal { background: #A8A878; } .bg-fire { background: #F08030; } .bg-water { background: #6890F0; }
        .bg-grass { background: #78C850; } .bg-electric { background: #F8D030; } .bg-ice { background: #98D8D8; }
        .bg-fighting { background: #C03028; } .bg-poison { background: #A040A0; } .bg-ground { background: #E0C068; }
        .bg-flying { background: #A890F0; } .bg-psychic { background: #F85888; } .bg-bug { background: #A8B820; }
        .bg-rock { background: #B8A038; } .bg-ghost { background: #705898; } .bg-dragon { background: #7038F8; }
        .bg-steel { background: #B8B8D0; } .bg-dark { background: #705848; } .bg-fairy { background: #EE99AC; }
    </style>
</head>
<body>

    <div class="header-bar">
        <h1>å¯¶å¯å¤¢æˆ°è¡“ç‰¹è¨“</h1>
        <div class="header-controls">
            <button class="header-btn btn-sound" id="btn-sound" onclick="game.toggleSound()">ğŸ”Š é–‹å•Ÿ</button>
            <button class="header-btn btn-chart" onclick="game.toggleChart()">ğŸ“– å±¬æ€§è¡¨</button>
        </div>
    </div>

    <!-- 1. ä¸»é¸å–® -->
    <div id="screen-menu" class="container active">
        <p>é¸æ“‡è¨“ç·´æ¨¡å¼ï¼š</p>
        <button class="action-btn btn-menu" onclick="game.initMode('attack')">
            âš”ï¸ æ”»æ“Šç‰¹è¨“<br><span style="font-size:0.8em; font-weight:normal;">é¸æ“‡å‰‹åˆ¶å±¬æ€§ (ç·´ç¿’å±¬æ€§è¡¨)</span>
        </button>
        <button class="action-btn btn-menu" style="background-color: #009688;" onclick="game.initMode('defense')">
            ğŸ›¡ï¸ é˜²å®ˆç‰¹è¨“<br><span style="font-size:0.8em; font-weight:normal;">é¸æ“‡æŠµæŠ—å±¬æ€§ (ç·´ç¿’è¯é˜²)</span>
        </button>
        <button class="action-btn btn-menu" style="background-color: #ff9800;" onclick="game.initMode('team')">
            ğŸ‘¥ 6é¸1 å¯¦æˆ°æ¨¡æ“¬<br><span style="font-size:0.8em; font-weight:normal;">éšŠä¼å¯¦æˆ°ï¼Œè¬›æ±‚æ”»é˜²ä¸€é«”</span>
        </button>
        
        <div style="margin-top:15px; font-size:0.9em; color:#666; text-align:left; background:#f9f9f9; padding:10px; border-radius:8px;">
            <b>æ›´æ–°èªªæ˜ï¼š</b><br>
            â€¢ <b>è²å…‰æ•ˆæœ</b>ï¼šå¯¶å¯å¤¢æœƒå»¶é²1ç§’ä¸¦ä¼´éš¨å«è²ç™»å ´ã€‚<br>
            â€¢ <b>è²éŸ³é–‹é—œ</b>ï¼šå³ä¸Šè§’å¯éš¨æ™‚åˆ‡æ›éœéŸ³ã€‚<br>
            â€¢ <b>é˜²å®ˆåˆ¤å®š</b>ï¼šå–®ç¨è¨ˆç®—æ¯å€‹å±¬æ€§å‚·å®³ï¼Œ1å€ç‚ºæ‰“å¹³ã€‚
        </div>
    </div>

    <!-- 2. éšŠä¼é¸æ“‡ (Draft) -->
    <div id="screen-draft" class="container" style="max-width: 850px;">
        <h2>çµ„å»ºä½ çš„éšŠä¼ (<span id="draft-count">0</span>/6)</h2>
        <button class="action-btn btn-random" onclick="game.randomDraft()">ğŸ² éš¨æ©Ÿçµ„éšŠ (å±¬æ€§å¹³è¡¡)</button>
        <div class="draft-layout">
            <div class="draft-sidebar" id="draft-filter-list"></div>
            <div class="draft-main">
                <div id="draft-grid" class="draft-grid"></div>
            </div>
        </div>
        <button id="btn-start-team" class="action-btn" disabled onclick="game.finishDraft()" style="background:#ccc;">é–‹å§‹æˆ°é¬¥</button>
        <button class="action-btn btn-exit" onclick="game.quitToMenu()">é€€å‡ºå›åˆ°é¸å–®</button>
    </div>

    <!-- 3. éŠæˆ²ä¸»ç•«é¢ -->
    <div id="screen-game" class="container" style="max-width: 600px;">
        <div class="status-bar">
            <div>å›åˆ: <span id="round-current">1</span>/10</div>
        </div>

        <div class="enemy-display">
            <img id="enemy-img" class="enemy-img" src="" alt="Enemy">
            <div id="enemy-name" style="font-size:1.5em; font-weight:bold; margin:5px 0; opacity: 0; transition: opacity 0.5s;">???</div>
            <div id="enemy-reveal" style="min-height:34px;"><span style="color:#999">??? å±¬æ€§ ???</span></div>
        </div>

        <div id="round-log" style="background:#fafafa; padding:10px; border-radius:8px; min-height:3em; font-size:1em; border:1px solid #eee; display:flex; align-items:center; justify-content:center; flex-direction:column; line-height:1.5;">
            ç­‰å¾…å°æ‰‹å‡ºç¾...
        </div>

        <div id="ui-types" class="grid-container" style="display:none;"></div>
        <div id="ui-team" class="battle-team-grid" style="display:none;"></div>

        <button id="btn-submit" class="action-btn btn-confirm" onclick="game.submit()">ç¢ºèªé¸æ“‡</button>
        <button id="btn-next" class="action-btn btn-next" onclick="game.nextRound()">ä¸‹ä¸€å›åˆ âœ</button>
        <button class="action-btn btn-exit" onclick="game.quitToMenu()">é€€å‡ºå›åˆ°é¸å–®</button>
    </div>

    <!-- 4. çµç®—ç•«é¢ -->
    <div id="screen-result" class="container">
        <h2>è¨“ç·´çµæŸ</h2>
        <p style="font-size:1.2em; margin:20px 0;">ç‰¹è¨“å®Œæˆï¼</p>
        <button class="action-btn" onclick="location.reload()">å›åˆ°ä¸»é¸å–®</button>
    </div>

    <!-- 5. å±¬æ€§è¡¨å°æŠ„ (Modal) -->
    <div id="modal-chart" class="modal-overlay" onclick="game.toggleChart()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 style="margin:0">å±¬æ€§ç›¸å‰‹è¡¨ (æ”» \ å®ˆ)</h3>
                <button onclick="game.toggleChart()" style="border:none;background:none;font-size:1.5em;cursor:pointer;">âœ•</button>
            </div>
            <div class="modal-body">
                <div id="chart-container"></div>
            </div>
        </div>
    </div>

    <script>
        // === è³‡æ–™åº« ===
        const RAW_DATA = [
            "3|å¦™è›™èŠ±|grass|poison","6|å™´ç«é¾|fire|flying","9|æ°´ç®­é¾œ|water","12|å·´å¤§è¶|bug|flying","15|å¤§é‡èœ‚|bug|poison","18|å¤§æ¯”é³¥|normal|flying","20|æ‹‰é”|normal","22|å¤§å˜´é›€|normal|flying","24|é˜¿æŸæ€ª|poison","26|é›·ä¸˜|electric","28|ç©¿å±±ç‹|ground","31|å°¼å¤šå|poison|ground","34|å°¼å¤šç‹|poison|ground","36|çš®å¯è¥¿|fairy","38|ä¹å°¾|fire","40|èƒ–å¯ä¸|normal|fairy","45|éœ¸ç‹èŠ±|grass|poison","47|æ´¾æ‹‰æ–¯ç‰¹|bug|grass","49|æ‘©é­¯è›¾|bug|poison","51|ä¸‰åœ°é¼ |ground","53|è²“è€å¤§|normal","55|å“¥é”é´¨|water","57|ç«çˆ†çŒ´|fighting","59|é¢¨é€Ÿç‹—|fire","62|å¿«æ³³è›™|water|fighting","65|èƒ¡åœ°|psychic","68|æ€ªåŠ›|fighting","71|å¤§é£ŸèŠ±|grass|poison","73|æ¯’åˆºæ°´æ¯|water|poison","76|éš†éš†å²©|rock|ground","78|çƒˆç„°é¦¬|fire","80|å‘†æ®¼ç¸|water|psychic","82|ä¸‰åˆä¸€ç£æ€ª|electric|steel","83|å¤§è”¥é´¨|normal|flying","85|å˜Ÿå˜Ÿåˆ©|normal|flying","87|ç™½æµ·ç…|water|ice","89|è‡­è‡­æ³¥|poison","91|åˆºç”²è²|water|ice","94|è€¿é¬¼|ghost|poison","95|å¤§å²©è›‡|rock|ground","97|å¼•å¤¢è²˜äºº|psychic","99|å·¨é‰—èŸ¹|water","101|é ‘çš®é›·å½ˆ|electric","103|æ¤°è›‹æ¨¹|grass|psychic","105|å˜å•¦å˜å•¦|ground","106|é£›è…¿éƒ|fighting","107|å¿«æ‹³éƒ|fighting","110|é›™å½ˆç“¦æ–¯|poison","112|é‘½è§’çŠ€ç¸|ground|rock","115|è¢‹ç¸|normal","119|é‡‘é­šç‹|water","121|å¯¶çŸ³æµ·æ˜Ÿ|water|psychic","122|é­”ç‰†äººå¶|psychic|fairy","123|é£›å¤©è³è‚|bug|flying","124|è¿·å”‡å§|ice|psychic","127|å‡±ç¾…æ–¯|bug","128|è‚¯æ³°ç¾…|normal","130|æš´é¯‰é¾|water|flying","131|æ‹‰æ™®æ‹‰æ–¯|water|ice","132|ç™¾è®Šæ€ª|normal","134|æ°´ä¼Šå¸ƒ|water","135|é›·ä¼Šå¸ƒ|electric","136|ç«ä¼Šå¸ƒ|fire","142|åŒ–çŸ³ç¿¼é¾|rock|flying","143|å¡æ¯”ç¸|normal","144|æ€¥å‡é³¥|ice|flying","145|é–ƒé›»é³¥|electric|flying","146|ç«ç„°é³¥|fire|flying","149|å¿«é¾|dragon|flying","150|è¶…å¤¢|psychic","151|å¤¢å¹»|psychic",
            "154|å¤§ç«ºè‘µ|grass","157|ç«æš´ç¸|fire","160|å¤§åŠ›é±·|water","162|å¤§å°¾ç«‹|normal","164|è²“é ­å¤œé·¹|normal|flying","166|å®‰ç“¢èŸ²|bug|flying","168|é˜¿åˆ©å¤šæ–¯|bug|poison","169|å‰å­—è |poison|flying","171|é›»ç‡ˆæ€ª|water|electric","178|å¤©ç„¶é³¥|psychic|flying","181|é›»é¾|electric","182|ç¾éº—èŠ±|grass","184|ç‘ªåŠ›éœ²éº—|water|fairy","185|æ¨¹æ‰æ€ª|rock","186|ç‰›è›™å›|water","189|æ¯½å­æ£‰|grass|flying","192|å‘æ—¥èŠ±æ€ª|grass","195|æ²¼ç‹|water|ground","196|å¤ªé™½ä¼Šå¸ƒ|psychic","197|æœˆäº®ä¼Šå¸ƒ|dark","199|å‘†å‘†ç‹|water|psychic","202|æœç„¶ç¿|psychic","203|éº’éºŸå¥‡|normal|psychic","205|ä½›çƒˆæ‰˜æ–¯|bug|steel","206|åœŸé¾å¼Ÿå¼Ÿ|normal","208|å¤§é‹¼è›‡|steel|ground","210|å¸ƒé­¯çš‡|fairy","212|å·¨é‰—è³è‚|bug|steel","213|å£ºå£º|bug|rock","214|èµ«æ‹‰å…‹ç¾…æ–¯|bug|fighting","217|åœˆåœˆç†Š|normal","219|ç†”å²©è¸ç‰›|fire|rock","222|å¤ªé™½çŠç‘š|water|rock","224|ç« é­šæ¡¶|water","225|ä¿¡ä½¿é³¥|ice|flying","226|å·¨ç¿…é£›é­š|water|flying","227|ç›”ç”²é³¥|steel|flying","229|é»‘é­¯åŠ |dark|fire","230|åˆºé¾ç‹|water|dragon","232|é “ç”²|ground","235|åœ–åœ–çŠ¬|normal","237|æˆ°èˆéƒ|fighting","241|å¤§å¥¶ç½|normal","242|å¹¸ç¦è›‹|normal","243|é›·å…¬|electric","244|ç‚å¸|fire","245|æ°´å›|water","248|ç­åŸºæ‹‰æ–¯|rock|dark","249|æ´›å¥‡äº|psychic|flying","250|é³³ç‹|fire|flying",
            "254|èœ¥èœ´ç‹|grass","257|ç«ç„°é›|fire|fighting","260|å·¨æ²¼æ€ª|water|ground","262|å¤§ç‹¼çŠ¬|dark","264|ç›´è¡ç†Š|normal","267|ç‹©çµé³³è¶|bug|flying","269|æ¯’ç²‰è›¾|bug|poison","272|æ¨‚å¤©æ²³ç«¥|water|grass","275|ç‹¡çŒ¾å¤©ç‹—|grass|dark","277|å¤§ç‹ç‡•|normal|flying","279|å¤§å˜´é·—|water|flying","282|æ²™å¥ˆæœµ|psychic|fairy","284|é›¨ç¿…è›¾|bug|flying","286|æ–—ç¬ è‡|grass|fighting","289|è«‹å‡ç‹|normal","291|éµé¢å¿è€…|bug|flying","292|è„«æ®¼å¿è€…|bug|ghost","295|çˆ†éŸ³æ€ª|normal","297|è¶…åŠ›ç‹|fighting","302|å‹¾é­‚çœ¼|dark|ghost","303|å¤§å˜´å¨ƒ|steel|fairy","306|æ³¢å£«å¯å¤šæ‹‰|steel|rock","308|æ°é›·å§†|fighting|psychic","310|é›·é›»ç¸|electric","311|æ­£é›»æ‹æ‹|electric","312|è² é›»æ‹æ‹|electric","313|é›»è¢èŸ²|bug","314|ç”œç”œè¢|bug","317|åé£Ÿç¸|poison","319|å·¨ç‰™é¯Š|water|dark","321|å¼é¯¨ç‹|water","323|å™´ç«é§|fire|ground","324|ç…¤ç‚­é¾œ|fire","326|å™—å™—è±¬|psychic","327|æ™ƒæ™ƒæ–‘|normal","330|æ²™æ¼ èœ»èœ“|ground|dragon","332|å¤¢æ­Œä»™äººæŒ|grass|dark","334|ä¸ƒå¤•é’é³¥|dragon|flying","335|è²“é¼¬æ–¬|normal","336|é£¯åŒ™è›‡|poison","337|æœˆçŸ³|rock|psychic","338|å¤ªé™½å²©|rock|psychic","340|é¯°é­šç‹|water|ground","342|éµè¯é¾è¦|water|dark","344|å¿µåŠ›åœŸå¶|ground|psychic","346|æ–ç±ƒç™¾åˆ|rock|grass","348|å¤ªå¤ç›”ç”²|rock|bug","350|ç¾ç´æ–¯|water","351|æ¼‚æµ®æ³¡æ³¡|normal","352|è®Šéš±é¾|normal","354|è©›å’’å¨ƒå¨ƒ|ghost","356|å½·å¾¨å¤œéˆ|ghost","357|ç†±å¸¶é¾|grass|flying","359|é˜¿å‹ƒæ¢­é­¯|dark","362|å†°é¬¼è­·|ice","365|å¸ç‰™æµ·ç…|ice|water","369|å¤ç©ºæ£˜é­š|water|rock","370|æ„›å¿ƒé­š|water","373|æš´é£›é¾|dragon|flying","376|å·¨é‡‘æ€ª|steel|psychic","377|é›·å‰æ´›å…‹|rock","378|é›·å‰è‰¾æ–¯|ice","379|é›·å‰æ–¯å¥‡é­¯|steel","380|æ‹‰å¸äºæ–¯|dragon|psychic","381|æ‹‰å¸æ­æ–¯|dragon|psychic","382|è“‹æ­å¡|water","383|å›ºæ‹‰å¤š|ground","384|çƒˆç©ºå|dragon|flying","386|ä»£æ­å¥‡å¸Œæ–¯|psychic",
            "389|åœŸå°é¾œ|grass|ground","392|çƒˆç„°çŒ´|fire|fighting","395|å¸ç‹æ‹¿æ³¢|water|steel","398|å§†å…‹é·¹|normal|flying","400|å¤§å°¾è²|normal|water","402|éŸ³ç®±èŸ€|bug","405|å€«ç´è²“|electric","407|ç¾…çµ²é›·æœµ|grass|poison","409|æˆ°æ§Œé¾|rock","411|è­·åŸé¾|rock|steel","413|çµè‰è²´å©¦|bug|grass","414|ç´³å£«è›¾|bug|flying","416|èœ‚å¥³ç‹|bug|flying","419|æµ®æ½›é¼¬|water","421|æ«»èŠ±å…’|grass","424|é›™å°¾æ€ªæ‰‹|normal","426|éš¨é¢¨çƒ|ghost|flying","428|é•·è€³å…”|normal","429|å¤¢å¦–é­”|ghost","430|çƒé´‰é ­é ­|dark|flying","432|æ±æ–½å–µ|normal","435|å¦å…‹è‡­é¼¬|poison|dark","437|é’éŠ…é˜|steel|psychic","441|è’å™ªé³¥|normal|flying","442|èŠ±å²©æ€ª|ghost|dark","445|çƒˆå’¬é™¸é¯Š|dragon|ground","448|è·¯å¡åˆ©æ­|fighting|steel","450|æ²³é¦¬ç¸|ground","452|é¾ç‹è |poison|dark","454|æ¯’éª·è›™|poison|fighting","455|å°–ç‰™ç± |grass","457|éœ“è™¹é­š|water","460|æš´é›ªç‹|grass|ice","461|ç‘ªç‹ƒæ‹‰|dark|ice","462|è‡ªçˆ†ç£æ€ª|electric|steel","464|è¶…ç”²ç‹‚çŠ€|ground|rock","465|å·¨è”“è—¤|grass","466|é›»æ“Šé­”ç¸|electric","467|é´¨å˜´ç‚ç¸|fire","468|æ³¢å…‹åŸºæ–¯|fairy|flying","469|é å¤å·¨èœ“|bug|flying","472|å¤©è ç‹|ground|flying","473|è±¡ç‰™è±¬|ice|ground","474|å¤šé‚Šç¸Z|normal","475|è‰¾è·¯é›·æœµ|psychic|fighting","476|å¤§æœåŒ—é¼»|rock|steel","477|é»‘å¤œé­”éˆ|ghost","478|é›ªå¦–å¥³|ice|ghost","479|æ´›æ‰˜å§†|electric|ghost","483|å¸ç‰™ç›§å¡|steel|dragon","484|å¸•è·¯å¥‡äº|water|dragon","485|å¸­å¤šè—æ©|fire|steel","487|é¨æ‹‰å¸ç´|ghost|dragon","488|å…‹é›·è‰²åˆ©äº|psychic","491|é”å…‹èŠä¼Š|dark","493|é˜¿çˆ¾å®™æ–¯|normal",
            "530|é¾é ­åœ°é¼ |ground|steel","534|ä¿®ç¹•è€é ­|fighting","545|èœˆèš£ç‹|bug|poison","547|é¢¨å¦–ç²¾|grass|fairy","553|æµæ°“é±·|ground|dark","555|é”æ‘©ç‹’ç‹’|fire","560|é ­å·¾æ··æ··|dark|fighting","561|è±¡å¾µé³¥|psychic|flying","563|æ­»ç¥æ£º|ghost","565|è‚‹éª¨æµ·é¾œ|water|rock","567|å§‹ç¥–å¤§é³¥|rock|flying","571|ç´¢ç¾…äºå…‹|dark","579|äººé€ ç´°èƒåµ|psychic","593|èƒ–å˜Ÿå˜Ÿ|water|ghost","596|é›»èœ˜è››|bug|electric","598|å …æœå•éˆ´|grass|steel","604|éº»éº»é°»é­šç‹|electric","609|æ°´æ™¶ç‡ˆç«éˆ|ghost|fire","612|é›™æ–§æˆ°é¾|dragon","620|å¸«çˆ¶é¼¬|fighting","623|æ³¥å¶å·¨äºº|ground|ghost","625|åŠˆæ–¬å¸ä»¤|dark|steel","628|å‹‡å£«é›„é·¹|normal|flying","630|ç¦¿é·¹å¨œ|dark|flying","635|ä¸‰é¦–æƒ¡é¾|dark|dragon","637|ç«ç¥è›¾|bug|fire","639|ä»£æ‹‰åŸºç¿|rock|fighting","641|é¾æ²é›²|flying","642|é›·æœé›²|electric|flying","645|åœŸåœ°é›²|ground|flying",
            "652|å¸ƒé‡Œå¡éš†|grass|fighting","655|å¦–ç«ç´…ç‹|fire|psychic","658|ç”²è³€å¿è›™|water|dark","660|æŒ–æ˜å…”|normal|ground","663|çƒˆç®­é·¹|fire|flying","666|å½©ç²‰è¶|bug|flying","673|åé¨å±±ç¾Š|grass","675|æµæ°“ç†Šè²“|fighting|dark","678|è¶…èƒ½å¦™å–µ|psychic","681|å …ç›¾åŠæ€ª|steel|ghost","687|çƒè³Šç‹|dark|psychic","691|æ¯’è—»é¾|poison|dragon","693|é‹¼ç‚®è‡‚è¦|water","697|æ€ªé¡é¾|rock|dragon","699|å†°é›ªå·¨é¾|rock|ice","700|ä»™å­ä¼Šå¸ƒ|fairy","701|æ‘”è§’é·¹äºº|fighting|flying","702|å’šå’šé¼ |electric|fairy","706|é»ç¾é¾|dragon","707|é‘°åœˆå…’|steel|fairy","709|æœ½æœ¨å¦–|ghost|grass","713|å†°å²©æ€ª|ice","715|éŸ³æ³¢é¾|flying|dragon","716|å“²çˆ¾å°¼äºæ–¯|fairy","717|ä¼Šè£´çˆ¾å¡”çˆ¾|dark|flying",
            "724|ç‹™å°„æ¨¹æ¢Ÿ|grass|ghost","727|ç†¾ç„°å’†å“®è™|fire|dark","730|è¥¿ç…æµ·å£¬|water|fairy","733|éŠƒå˜´å¤§é³¥|normal|flying","735|è²“é¼¬æ¢é•·|normal","738|é¬è¾²ç‚®èŸ²|bug|electric","740|å¥½å‹æ¯›èŸ¹|fighting|ice","743|è¶çµèŒè™»|bug|fairy","745|é¬ƒå²©ç‹¼äºº|rock","746|å¼±ä¸é­š|water","748|è¶…å£æ˜Ÿ|poison|water","750|é‡æ³¥æŒ½é¦¬|ground","752|æ»´è››éœ¸|water|bug","754|è˜­è³èŠ±|grass","758|ç„°åèœ¥|poison|fire","760|ç©¿è‘—ç†Š|normal|fighting","763|ç”œå†·ç¾å|grass","764|èŠ±ç™‚ç’°ç’°|fairy","765|æ™ºæ®çŒ©|normal|psychic","768|å…·ç”²æ­¦è€…|bug|water","770|å™¬æ²™å ¡çˆº|ghost|ground","773|éŠ€ä¼´æˆ°ç¸|normal","774|å°éš•æ˜Ÿ|rock|flying","775|æ¨¹æ•å°¾ç†Š|normal","776|çˆ†ç„°é¾œç¸|fire|dragon","777|æ‰˜æˆˆå¾·ç‘ªçˆ¾|electric|steel","778|è¬æ“¬Q|ghost|fairy","779|ç£¨ç‰™å½©çš®é­š|water|psychic","780|è€ç¿é¾|normal|dragon","781|ç ´ç ´èˆµè¼ª|ghost|grass","784|æ–å°¾é±—ç”²é¾|dragon|fighting","785|å¡ç’ãƒ»é³´é³´|electric|fairy",
            "812|è½Ÿæ“‚é‡‘å‰›çŒ©|grass","815|é–ƒç„°ç‹ç‰Œ|fire","818|åƒé¢é¿å½¹|water","820|è—é£½æ —é¼ |normal","823|é‹¼é§é´‰|flying|steel","826|ä»¥æ­è·¯æ™®|bug|psychic","832|æ¯›æ¯›è§’ç¾Š|normal","834|æš´å™¬é¾œ|water|rock","839|å·¨ç‚­å±±|rock|fire","842|è˜‹è£¹é¾|grass|dragon","845|å¤æœˆé³¥|flying|water","849|é¡«å¼¦è²|electric|poison","851|ç„šç„°èš£|fire|bug","853|å…«çˆªæ­¦å¸«|fighting","855|æ€–æ€å£º|ghost","858|å¸ƒè‰å§†æº«|psychic|fairy","861|é•·æ¯›å·¨é­”|dark|fairy","862|å µæ””ç†Š|dark|normal","865|è”¥éŠå…µ|fighting","869|éœœå¥¶ä»™|fairy","870|åˆ—é™£å…µ|fighting","871|å•ªåš“æµ·è†½|electric","873|é›ªçµ¨è›¾|ice|bug","874|å·¨çŸ³ä¸|rock","875|å†°ç Œéµ|ice","877|è«é­¯è²å¯|electric|dark","879|å¤§ç‹éŠ…è±¡|steel","884|é‹é‹¼é¾|steel|dragon","887|å¤šé¾å·´é­¯æ‰˜|dragon|ghost","892|æ­¦é“ç†Šå¸«|fighting","905|çœ·æˆ€é›²|fairy|flying"
        ];

        const POKEMON_DB = RAW_DATA.map(str => {
            const parts = str.split('|');
            return { id: parseInt(parts[0]), name: parts[1], types: parts.slice(2) };
        });

        const TYPES = ['normal', 'fire', 'water', 'grass', 'electric', 'ice', 'fighting', 'poison', 'ground', 'flying', 'psychic', 'bug', 'rock', 'ghost', 'dragon', 'steel', 'dark', 'fairy'];
        
        const TYPE_ICONS = {
            normal: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/normal.svg',
            fire: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/fire.svg',
            water: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/water.svg',
            grass: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/grass.svg',
            electric: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/electric.svg',
            ice: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/ice.svg',
            fighting: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/fighting.svg',
            poison: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/poison.svg',
            ground: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/ground.svg',
            flying: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/flying.svg',
            psychic: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/psychic.svg',
            bug: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/bug.svg',
            rock: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/rock.svg',
            ghost: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/ghost.svg',
            dragon: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/dragon.svg',
            steel: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/steel.svg',
            dark: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/dark.svg',
            fairy: 'https://raw.githubusercontent.com/duiker101/pokemon-type-svg-icons/master/icons/fairy.svg'
        };

        const TYPE_NAMES = { 'normal':'ä¸€èˆ¬', 'fire':'ç«', 'water':'æ°´', 'grass':'è‰', 'electric':'é›»', 'ice':'å†°', 'fighting':'æ ¼é¬¥', 'poison':'æ¯’', 'ground':'åœ°é¢', 'flying':'é£›è¡Œ', 'psychic':'è¶…èƒ½', 'bug':'èŸ²', 'rock':'å²©çŸ³', 'ghost':'å¹½éˆ', 'dragon':'é¾', 'steel':'é‹¼', 'dark':'æƒ¡', 'fairy':'å¦–ç²¾' };

        const TYPE_CHART = {
            normal: { rock: 0.5, ghost: 0, steel: 0.5 },
            fire: { fire: 0.5, water: 0.5, grass: 2, ice: 2, bug: 2, rock: 0.5, dragon: 0.5, steel: 2 },
            water: { fire: 2, water: 0.5, grass: 0.5, ground: 2, rock: 2, dragon: 0.5 },
            grass: { fire: 0.5, water: 2, grass: 0.5, poison: 0.5, ground: 2, flying: 0.5, bug: 0.5, rock: 2, dragon: 0.5, steel: 0.5 },
            electric: { water: 2, grass: 0.5, electric: 0.5, ground: 0, flying: 2, dragon: 0.5 },
            ice: { fire: 0.5, water: 0.5, grass: 2, ice: 0.5, ground: 2, flying: 2, dragon: 2, steel: 0.5 },
            fighting: { normal: 2, ice: 2, poison: 0.5, flying: 0.5, psychic: 0.5, bug: 0.5, rock: 2, ghost: 0, dark: 2, steel: 2, fairy: 0.5 },
            poison: { grass: 2, poison: 0.5, ground: 0.5, rock: 0.5, ghost: 0.5, steel: 0, fairy: 2 },
            ground: { fire: 2, grass: 0.5, electric: 2, poison: 2, flying: 0, bug: 0.5, rock: 2, steel: 2 },
            flying: { grass: 2, electric: 0.5, fighting: 2, bug: 2, rock: 0.5, steel: 0.5 },
            psychic: { fighting: 2, poison: 2, psychic: 0.5, dark: 0, steel: 0.5 },
            bug: { fire: 0.5, grass: 2, fighting: 0.5, poison: 0.5, flying: 0.5, psychic: 2, ghost: 0.5, dark: 2, steel: 0.5, fairy: 0.5 },
            rock: { fire: 2, ice: 2, fighting: 0.5, ground: 0.5, flying: 2, bug: 2, steel: 0.5 },
            ghost: { normal: 0, psychic: 2, ghost: 2, dark: 0.5 },
            dragon: { dragon: 2, steel: 0.5, fairy: 0 },
            steel: { fire: 0.5, water: 0.5, electric: 0.5, ice: 2, rock: 2, steel: 0.5, fairy: 2 },
            dark: { fighting: 0.5, psychic: 2, ghost: 2, dark: 0.5, fairy: 0.5 },
            fairy: { fire: 0.5, fighting: 2, poison: 0.5, dragon: 2, dark: 2, steel: 0.5 }
        };

        function getIconHtml(type, isMini = false) {
            const wrapperClass = isMini ? 'type-icon-wrapper mini-icon-wrapper' : 'type-icon-wrapper';
            const svgClass = isMini ? 'type-icon-svg mini-icon-svg' : 'type-icon-svg';
            return `<div class="${wrapperClass} bg-${type}"><img src="${TYPE_ICONS[type]}" class="${svgClass}"></div>`;
        }

        class Game {
            constructor() {
                this.mode = 'attack';
                this.rounds = 10;
                this.currRound = 0;
                this.playerTeam = [];
                this.selectedTypes = new Set();
                this.selectedPokemon = null;
                this.currentDraftFilter = 'all';
                this.soundEnabled = true;

                this.initTypeUI();
                this.generateTypeChart();
            }

            // === è²éŸ³æ§åˆ¶ ===
            toggleSound() {
                this.soundEnabled = !this.soundEnabled;
                const btn = document.getElementById('btn-sound');
                if (this.soundEnabled) {
                    btn.textContent = 'ğŸ”Š é–‹å•Ÿ';
                    btn.classList.remove('muted');
                } else {
                    btn.textContent = 'ğŸ”‡ éœéŸ³';
                    btn.classList.add('muted');
                }
            }

            playCry(id) {
                if (!this.soundEnabled) return;
                const audio = new Audio(`https://raw.githubusercontent.com/PokeAPI/cries/main/cries/pokemon/latest/${id}.ogg`);
                audio.volume = 0.4; 
                audio.play().catch(e => console.log("Audio play failed (interaction needed):", e));
            }

            generateTypeChart() {
                const container = document.getElementById('chart-container');
                let html = '<table class="chart-table">';
                html += '<thead><tr class="chart-header"><th>æ”»\\å®ˆ</th>';
                TYPES.forEach(t => { html += `<th><div class="type-icon-wrapper bg-${t}" style="width:20px;height:20px;margin:0;"><img src="${TYPE_ICONS[t]}" class="type-icon-svg" style="width:12px;height:12px;"></div></th>`; });
                html += '</tr></thead><tbody>';
                TYPES.forEach(atk => {
                    html += `<tr><td class="chart-side-header"><div class="type-icon-wrapper bg-${atk}" style="width:20px;height:20px;margin:0;"><img src="${TYPE_ICONS[atk]}" class="type-icon-svg" style="width:12px;height:12px;"></div></td>`;
                    TYPES.forEach(def => {
                        let val = 1;
                        if(TYPE_CHART[atk] && TYPE_CHART[atk][def] !== undefined) val = TYPE_CHART[atk][def];
                        let cellClass = ''; let content = '';
                        if(val === 2) { cellClass = 'cell-2x'; content = '2'; }
                        else if(val === 0.5) { cellClass = 'cell-05x'; content = 'Â½'; }
                        else if(val === 0) { cellClass = 'cell-0x'; content = '0'; }
                        html += `<td class="${cellClass}">${content}</td>`;
                    });
                    html += '</tr>';
                });
                html += '</tbody></table>';
                container.innerHTML = html;
            }

            toggleChart() {
                const modal = document.getElementById('modal-chart');
                if(modal.style.display === 'flex') modal.style.display = 'none';
                else modal.style.display = 'flex';
            }

            initTypeUI() {
                const grid = document.getElementById('ui-types');
                TYPES.forEach(t => {
                    const b = document.createElement('div');
                    b.className = `game-btn bg-${t}`;
                    b.innerHTML = `${getIconHtml(t)} ${TYPE_NAMES[t]}`;
                    b.onclick = () => this.toggleType(t, b);
                    grid.appendChild(b);
                });
            }

            toggleType(type, btn) {
                if(document.getElementById('btn-submit').disabled) return;
                if (this.selectedTypes.has(type)) {
                    this.selectedTypes.delete(type);
                    btn.classList.remove('selected');
                } else {
                    if (this.selectedTypes.size >= 2) { alert("æœ€å¤šé¸2å€‹"); return; }
                    this.selectedTypes.add(type);
                    btn.classList.add('selected');
                }
            }

            initMode(m) {
                this.mode = m;
                document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
                if (m === 'team') this.startDraft();
                else this.startGame();
            }

            quitToMenu() {
                if (confirm("ç¢ºå®šè¦çµæŸç›®å‰éŠæˆ²ï¼Œå›åˆ°ä¸»é¸å–®å—ï¼Ÿ")) {
                    document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
                    document.getElementById('screen-menu').classList.add('active');
                }
            }

            startDraft() {
                document.getElementById('screen-draft').classList.add('active');
                this.playerTeam = [];
                this.currentDraftFilter = 'all';
                this.initDraftSidebar();
                this.renderDraftGrid();
                this.updateDraftStatus();
            }

            randomDraft() {
                this.playerTeam = [];
                let available = [...POKEMON_DB];
                available.sort(() => Math.random() - 0.5);
                let usedTypes = new Set();
                for (let poke of available) {
                    if (this.playerTeam.length >= 6) break;
                    let isUnique = true;
                    for (let t of poke.types) {
                        if (usedTypes.has(t) && poke.types.indexOf(t) === 0) isUnique = false;
                    }
                    if (isUnique || this.playerTeam.length < 2) { 
                        this.playerTeam.push(poke);
                        poke.types.forEach(t => usedTypes.add(t));
                    }
                }
                if (this.playerTeam.length < 6) {
                    let remain = available.filter(p => !this.playerTeam.includes(p));
                    while(this.playerTeam.length < 6 && remain.length > 0) {
                        this.playerTeam.push(remain.pop());
                    }
                }
                this.updateDraftStatus();
                this.renderDraftGrid(); 
            }

            initDraftSidebar() {
                const sidebar = document.getElementById('draft-filter-list');
                sidebar.innerHTML = '';
                const btnAll = document.createElement('div');
                btnAll.className = 'filter-btn active';
                btnAll.textContent = 'å…¨éƒ¨é¡¯ç¤º';
                btnAll.onclick = () => this.setDraftFilter('all', btnAll);
                sidebar.appendChild(btnAll);
                TYPES.forEach(t => {
                    const btn = document.createElement('div');
                    btn.className = 'filter-btn';
                    btn.innerHTML = `${getIconHtml(t, true)} ${TYPE_NAMES[t]}`;
                    btn.style.borderLeft = `4px solid #ccc`;
                    btn.onclick = () => this.setDraftFilter(t, btn);
                    sidebar.appendChild(btn);
                });
            }

            setDraftFilter(type, btnElement) {
                this.currentDraftFilter = type;
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btnElement.classList.add('active');
                this.renderDraftGrid();
            }

            renderDraftGrid() {
                const grid = document.getElementById('draft-grid');
                grid.innerHTML = '';
                const filteredList = this.currentDraftFilter === 'all' 
                    ? POKEMON_DB 
                    : POKEMON_DB.filter(p => p.types.includes(this.currentDraftFilter));

                filteredList.forEach(p => {
                    const card = document.createElement('div');
                    card.className = 'draft-card';
                    if (this.playerTeam.includes(p)) card.classList.add('picked');

                    const typeDots = p.types.map(t => `<span class="mini-type-dot bg-${t}"></span>`).join(' ');

                    card.innerHTML = `
                        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${p.id}.png" loading="lazy">
                        <div class="draft-name">${p.name}</div>
                        <div class="draft-types">${typeDots}</div>
                    `;
                    
                    card.onclick = () => {
                        // é»æ“Šå¡ç‰‡æ™‚æ’­æ”¾å«è² (å¦‚æœæ²’é¸å–é)
                        this.playCry(p.id);

                        if (this.playerTeam.includes(p)) {
                            this.playerTeam = this.playerTeam.filter(x => x !== p);
                            card.classList.remove('picked');
                        } else {
                            if (this.playerTeam.length >= 6) return;
                            this.playerTeam.push(p);
                            card.classList.add('picked');
                        }
                        this.updateDraftStatus();
                    };
                    grid.appendChild(card);
                });
            }

            updateDraftStatus() {
                document.getElementById('draft-count').textContent = this.playerTeam.length;
                const btn = document.getElementById('btn-start-team');
                if (this.playerTeam.length === 6) {
                    btn.disabled = false;
                    btn.style.backgroundColor = '#4caf50';
                    btn.style.cursor = 'pointer';
                } else {
                    btn.disabled = true;
                    btn.style.backgroundColor = '#ccc';
                    btn.style.cursor = 'not-allowed';
                }
            }

            finishDraft() {
                this.startGame();
            }

            startGame() {
                document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
                document.getElementById('screen-game').classList.add('active');
                const uiType = document.getElementById('ui-types');
                const uiTeam = document.getElementById('ui-team');
                if (this.mode === 'team') {
                    uiType.style.display = 'none';
                    uiTeam.style.display = 'grid';
                    this.renderBattleTeam();
                } else {
                    uiType.style.display = 'grid';
                    uiTeam.style.display = 'none';
                }
                this.currRound = 0;
                this.nextRound();
            }

            renderBattleTeam() {
                const grid = document.getElementById('ui-team');
                grid.innerHTML = '';
                this.playerTeam.forEach(p => {
                    const card = document.createElement('div');
                    card.className = 'team-card';
                    const badges = p.types.map(t => `<span class="type-badge-text bg-${t}">${getIconHtml(t, true)} ${TYPE_NAMES[t]}</span>`).join('');
                    card.innerHTML = `
                        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${p.id}.png" style="width:60px;height:60px;">
                        <div style="font-size:0.8em;font-weight:bold">${p.name}</div>
                        <div style="display:flex;justify-content:center;margin-top:2px;flex-wrap:wrap;">${badges}</div>
                    `;
                    card.onclick = () => {
                        if(document.getElementById('btn-submit').style.display === 'none') return;
                        
                        // æˆ°é¬¥ä¸­é»æ“ŠéšŠä¼ï¼Œä¹Ÿæ’­æ”¾ä¸€ä¸‹å«è²
                        this.playCry(p.id);

                        document.querySelectorAll('.team-card').forEach(c=>c.classList.remove('selected'));
                        this.selectedPokemon = p;
                        card.classList.add('selected');
                    };
                    grid.appendChild(card);
                });
            }

            nextRound() {
                if (this.currRound >= this.rounds) {
                    this.endGame();
                    return;
                }
                this.currRound++;
                document.getElementById('round-current').textContent = this.currRound;
                this.selectedTypes.clear();
                this.selectedPokemon = null;
                document.querySelectorAll('.game-btn').forEach(b => b.classList.remove('selected'));
                document.querySelectorAll('.team-card').forEach(c => c.classList.remove('selected'));
                
                this.enemy = POKEMON_DB[Math.floor(Math.random() * POKEMON_DB.length)];
                document.getElementById('enemy-name').textContent = this.enemy.name;
                
                // è¨­å®šåœ–ç‰‡ (å…ˆéš±è—)
                const enemyImg = document.getElementById('enemy-img');
                enemyImg.style.opacity = '0'; 
                enemyImg.src = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${this.enemy.id}.png`;
                
                // è¨­å®šæ–‡å­—èˆ‡æŒ‰éˆ•
                const nameText = document.getElementById('enemy-name');
                nameText.style.opacity = '0';

                document.getElementById('enemy-reveal').innerHTML = `<span style="color:#999">??? å±¬æ€§ ???</span>`;
                let hint = "";
                if (this.mode === 'team') hint = "è«‹æ´¾å‡ºå¯¶å¯å¤¢ï¼";
                else if (this.mode === 'attack') hint = "è«‹é¸æ“‡ å‰‹åˆ¶ å®ƒçš„å±¬æ€§ï¼";
                else hint = "è«‹é¸æ“‡ æŠµæŠ— å®ƒçš„å±¬æ€§ï¼";
                document.getElementById('round-log').innerHTML = hint;
                document.getElementById('btn-submit').style.display = 'inline-block';
                document.getElementById('btn-next').style.display = 'none';

                // å»¶é² 1 ç§’å¾Œé¡¯ç¤ºä¸¦æ’­æ”¾è²éŸ³
                setTimeout(() => {
                    enemyImg.style.opacity = '1';
                    nameText.style.opacity = '1';
                    this.playCry(this.enemy.id);
                }, 1000);
            }

            calcDmg(atk, defs) {
                let m = 1;
                defs.forEach(d => { if(TYPE_CHART[atk] && TYPE_CHART[atk][d]!=undefined) m *= TYPE_CHART[atk][d]; });
                return m;
            }

            submit() {
                if (this.mode === 'team' && !this.selectedPokemon) { alert("è«‹é¸å¯¶å¯å¤¢"); return; }
                if (this.mode !== 'team' && this.selectedTypes.size === 0) { alert("è«‹é¸å±¬æ€§"); return; }

                const reveal = document.getElementById('enemy-reveal');
                reveal.innerHTML = this.enemy.types.map(t => `<span class="type-badge-text bg-${t}">${getIconHtml(t, true)} ${TYPE_NAMES[t]}</span>`).join('');

                let log = "";

                if (this.mode === 'attack') {
                    let max = 0;
                    this.selectedTypes.forEach(t => { const v = this.calcDmg(t, this.enemy.types); if(v>max) max=v; });
                    if (max >= 4) log = "<span class='text-super'>æ•ˆæœçµ•ä½³ï¼ï¼ (x4)</span>";
                    else if (max > 1) log = "<span class='text-super'>æ•ˆæœçµ•ä½³ (x2)</span>";
                    else log = "<span class='text-immune'>æ•ˆæœä¸å¥½/ç„¡æ•ˆ...</span>";
                } 
                else if (this.mode === 'defense') {
                    let fail = false;
                    let details = [];
                    const defs = Array.from(this.selectedTypes);
                    
                    this.enemy.types.forEach(et => {
                        const v = this.calcDmg(et, defs);
                        let status = "";
                        if(v > 1) { fail = true; status = `<span class="text-super">è¢«å‰‹åˆ¶ (x${v})</span>`; }
                        else if(v < 1) status = `<span class="text-weak">æŠµæŠ— (x${v})</span>`;
                        else status = `<span class="text-normal">æ™®é€š (x1)</span>`;
                        details.push(`${TYPE_ICONS[et] ? `<img src="${TYPE_ICONS[et]}" style="width:14px;vertical-align:middle">` : et} ${status}`);
                    });

                    log = details.join('<br>');
                    if(!fail) {
                        let allResist = this.enemy.types.every(et => this.calcDmg(et, defs) < 1);
                        if(allResist) log += `<br><span class='text-perfect'>â˜… å®Œç¾é˜²å®ˆï¼</span>`;
                        else log += `<br><span class='text-weak'>é˜²å®ˆæˆåŠŸ (æœªè¢«çªç ´)</span>`;
                    } else {
                        log += `<br><span class='text-super'>é˜²å®ˆå¤±æ•—ï¼</span>`;
                    }
                } 
                else {
                    let myMax = 0;
                    this.selectedPokemon.types.forEach(t => { const v = this.calcDmg(t, this.enemy.types); if(v>myMax) myMax=v; });
                    let enMax = 0;
                    this.enemy.types.forEach(t => { const v = this.calcDmg(t, this.selectedPokemon.types); if(v>enMax) enMax=v; });

                    log = `æˆ‘æ–¹æ”»æ“Š x${myMax} | æ•µæ–¹æ”»æ“Š x${enMax}<br>`;
                    if (myMax > 1 && enMax < 1) {
                        log += `<span class="text-perfect">â˜… å®Œç¾æ”»é˜²ï¼ â˜…</span>`;
                    } else if (myMax > 1) {
                        log += `<span class="text-super">é€²æ”»æˆåŠŸï¼</span>`;
                    } else if (enMax < 1) {
                        log += `<span class="text-weak">é˜²å®ˆæˆåŠŸï¼</span>`;
                    } else {
                        log += `<span class="text-immune">æ•ˆæœæ™®é€š</span>`;
                    }
                }

                document.getElementById('round-log').innerHTML = log;
                document.getElementById('btn-submit').style.display = 'none';
                document.getElementById('btn-next').style.display = 'inline-block';
            }

            endGame() {
                document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
                document.getElementById('screen-result').classList.add('active');
            }
        }

        const game = new Game();
    </script>
</body>
</html>